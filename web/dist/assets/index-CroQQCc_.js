function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/index-DOrJX-hs.js","assets/react-core-BFSJPjG3.js","assets/semi-ui-Df9G_U0w.js","assets/semi-ui-BPR-lEnf.css","assets/tools-Dkpv0T9F.js","assets/react-components-DWFaeFsy.js","assets/semantic-NyQ_Ythi.js","assets/index-B0XWZASL.js","assets/visactor-CjOqfKHz.js","assets/index-Bj_vxtXX.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
import{r as s,a as it,u as _e,N as rt,L as eu,R as su,e as vu,f as ot,h as ct,i as Fe,B as dt}from"./react-core-BFSJPjG3.js";import{S as Ge,T as Pe,e as D,f as nu,g as Ue,h as ce,B as w,I as te,i as Y,j as De,D as Fu,F as X,k as Je,l as Le,P as Ae,L as ae,m as Wu,C as qe,n as Iu,o as ht,M as fe,R as Ft,p as mt,q as au,r as yu,A as ku,s as Me,t as pt,u as gt,v as xt,w as Pu,x as Bu,y as Du,z as Hu,E as ze,G as Ku,H as Et,J as Au,K as qu,N as Ct,O as jt,Q as ft,U as $e,V as yt,W as Qu,X as Ju,Y as Bt,Z as Dt,$ as At,a0 as bt,a1 as wt,a2 as St,a3 as vt,a4 as kt,a5 as _t}from"./semi-ui-Df9G_U0w.js";import{c as Tt,a as It}from"./tools-Dkpv0T9F.js";import{Q as Pt,_ as Qe,T as Vu,f as ju,k as Rt}from"./react-components-DWFaeFsy.js";import{G as ke,H as oe,I as _u,F as h,S as gu,B as Ne,M as mu,D as ge,a as cu,b as Mt,L as Lt}from"./semantic-NyQ_Ythi.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))i(d);new MutationObserver(d=>{for(const c of d)if(c.type==="childList")for(const p of c.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&i(p)}).observe(document,{childList:!0,subtree:!0});function a(d){const c={};return d.integrity&&(c.integrity=d.integrity),d.referrerPolicy&&(c.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?c.credentials="include":d.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(d){if(d.ep)return;d.ep=!0;const c=a(d);fetch(d.href,c)}})();var Yu={exports:{}},xu={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zt=s,Ot=Symbol.for("react.element"),$t=Symbol.for("react.fragment"),Nt=Object.prototype.hasOwnProperty,Gt=zt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ut={key:!0,ref:!0,__self:!0,__source:!0};function Zu(u,t,a){var i,d={},c=null,p=null;a!==void 0&&(c=""+a),t.key!==void 0&&(c=""+t.key),t.ref!==void 0&&(p=t.ref);for(i in t)Nt.call(t,i)&&!Ut.hasOwnProperty(i)&&(d[i]=t[i]);if(u&&u.defaultProps)for(i in t=u.defaultProps,t)d[i]===void 0&&(d[i]=t[i]);return{$$typeof:Ot,type:u,key:c,ref:p,props:d,_owner:Gt.current}}xu.Fragment=$t;xu.jsx=Zu;xu.jsxs=Zu;Yu.exports=xu;var e=Yu.exports,bu={},Ru=it;bu.createRoot=Ru.createRoot,bu.hydrateRoot=Ru.hydrateRoot;const Wt="modulepreload",Ht=function(u){return"/"+u},Mu={},Tu=function(t,a,i){let d=Promise.resolve();if(a&&a.length>0){const c=document.getElementsByTagName("link"),p=document.querySelector("meta[property=csp-nonce]"),B=(p==null?void 0:p.nonce)||(p==null?void 0:p.getAttribute("nonce"));d=Promise.all(a.map(b=>{if(b=Ht(b),b in Mu)return;Mu[b]=!0;const _=b.endsWith(".css"),P=_?'[rel="stylesheet"]':"";if(!!i)for(let j=c.length-1;j>=0;j--){const o=c[j];if(o.href===b&&(!_||o.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${b}"]${P}`))return;const F=document.createElement("link");if(F.rel=_?"stylesheet":Wt,_||(F.as="script",F.crossOrigin=""),F.href=b,B&&F.setAttribute("nonce",B),document.head.appendChild(F),_)return new Promise((j,o)=>{F.addEventListener("load",j),F.addEventListener("error",()=>o(new Error(`Unable to preload CSS for ${b}`)))})}))}return d.then(()=>t()).catch(c=>{const p=new Event("vite:preloadError",{cancelable:!0});if(p.payload=c,window.dispatchEvent(p),!p.defaultPrevented)throw c})},ye=({prompt:u="page"})=>e.jsxs(Ge,{style:{height:100},spinning:!0,children:["加载",u,"中..."]}),Kt=Tt(),ie=10,hu=[{key:1,text:"OpenAI",value:1,color:"green",label:"OpenAI"},{key:2,text:"Midjourney Proxy",value:2,color:"light-blue",label:"Midjourney Proxy"},{key:5,text:"Midjourney Proxy Plus",value:5,color:"blue",label:"Midjourney Proxy Plus"},{key:4,text:"Ollama",value:4,color:"grey",label:"Ollama"},{key:14,text:"Anthropic Claude",value:14,color:"indigo",label:"Anthropic Claude"},{key:3,text:"Azure OpenAI",value:3,color:"teal",label:"Azure OpenAI"},{key:11,text:"Google PaLM2",value:11,color:"orange",label:"Google PaLM2"},{key:24,text:"Google Gemini",value:24,color:"orange",label:"Google Gemini"},{key:15,text:"百度文心千帆",value:15,color:"blue",label:"百度文心千帆"},{key:17,text:"阿里通义千问",value:17,color:"orange",label:"阿里通义千问"},{key:18,text:"讯飞星火认知",value:18,color:"blue",label:"讯飞星火认知"},{key:16,text:"智谱 ChatGLM",value:16,color:"violet",label:"智谱 ChatGLM"},{key:16,text:"智谱 GLM-4V",value:26,color:"purple",label:"智谱 GLM-4V"},{key:16,text:"Moonshot",value:25,color:"green",label:"Moonshot"},{key:19,text:"360 智脑",value:19,color:"blue",label:"360 智脑"},{key:23,text:"腾讯混元",value:23,color:"teal",label:"腾讯混元"},{key:31,text:"零一万物",value:31,color:"green",label:"零一万物"},{key:8,text:"自定义渠道",value:8,color:"pink",label:"自定义渠道"},{key:22,text:"知识库：FastGPT",value:22,color:"blue",label:"知识库：FastGPT"},{key:21,text:"知识库：AI Proxy",value:21,color:"purple",label:"知识库：AI Proxy"}],qt=({htmlContent:u})=>e.jsx("div",{dangerouslySetInnerHTML:{__html:u}});function be(){let u=localStorage.getItem("user");return u?(u=JSON.parse(u),u.role>=10):!1}function Xu(){let u=localStorage.getItem("user");return u?(u=JSON.parse(u),u.role>=100):!1}function Eu(){let u=localStorage.getItem("system_name");return u||"New API"}function lu(){let u=localStorage.getItem("logo");return u||"/logo.png"}function Qt(){return localStorage.getItem("footer_html")}async function Re(u){let t=!0;try{await navigator.clipboard.writeText(u)}catch(a){t=!1,console.error(a)}return t}function Be(){return window.innerWidth<=600}let et={autoClose:!1};Be()&&(et.position="top-center");function E(u){if(console.error(u),u.message){if(u.name==="AxiosError"){switch(u.response.status){case 401:window.location.href="/login?expired=true";break;case 429:Pe.error("错误：请求次数过多，请稍后再试！");break;case 500:Pe.error("错误：服务器内部错误，请联系管理员！");break;case 405:Pe.info("本站仅作演示之用，无服务端！");break;default:Pe.error("错误："+u.message)}return}Pe.error("错误："+u.message)}else Pe.error("错误："+u)}function Z(u){Pe.success(u)}function je(u){Pe.info(u)}function Lu(u,t=!1){t?Pt(e.jsx(qt,{htmlContent:u}),et):Pe.info(u)}function fu(u){return u.endsWith("/")?u.slice(0,-1):u}function we(u){let t=new Date(u*1e3),a=t.getFullYear().toString(),i=(t.getMonth()+1).toString(),d=t.getDate().toString(),c=t.getHours().toString(),p=t.getMinutes().toString(),B=t.getSeconds().toString();return i.length===1&&(i="0"+i),d.length===1&&(d="0"+d),c.length===1&&(c="0"+c),p.length===1&&(p="0"+p),B.length===1&&(B="0"+B),a+"-"+i+"-"+d+" "+c+":"+p+":"+B}function cn(u,t="hour"){let a=new Date(u*1e3),i=(a.getMonth()+1).toString(),d=a.getDate().toString(),c=a.getHours().toString();i.length===1&&(i="0"+i),d.length===1&&(d="0"+d),c.length===1&&(c="0"+c);let p=i+"-"+d;if(t==="hour")p+=" "+c+":00";else if(t==="week"){let B=new Date(u*1e3+5184e5),b=(B.getMonth()+1).toString(),_=B.getDate().toString();b.length===1&&(b="0"+b),_.length===1&&(_="0"+_),p+=" - "+b+"-"+_}return p}function Jt(u,t){let a=new Blob([u],{type:"text/plain;charset=utf-8"}),i=URL.createObjectURL(a),d=document.createElement("a");d.href=i,d.download=t,d.click()}const Xe=u=>{try{JSON.parse(u)}catch{return!1}return!0};function Vt(u){return!localStorage.getItem(`prompt-${u}`)}var zu={BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const v=It.create({baseURL:zu.VITE_REACT_APP_SERVER_URL?zu.VITE_REACT_APP_SERVER_URL:""});v.interceptors.response.use(u=>u,u=>{E(u)});function ut(u){if(u==="")return e.jsx(D,{size:"large",children:"default"});let t=u.split(",");return t.sort(),e.jsx(e.Fragment,{children:t.map(a=>a==="vip"||a==="pro"?e.jsx(D,{size:"large",color:"yellow",children:a}):a==="svip"||a==="premium"?e.jsx(D,{size:"large",color:"red",children:a}):a==="default"?e.jsx(D,{size:"large",children:a}):e.jsx(D,{size:"large",color:tu(a),children:a}))})}function pu(u){return u>=1e9?(u/1e9).toFixed(1)+"B":u>=1e6?(u/1e6).toFixed(1)+"M":u>=1e4?(u/1e3).toFixed(1)+"k":u}function dn(u,t=2){let a=localStorage.getItem("display_in_currency");return u=u.toFixed(t),a?"$"+u:u}function Yt(u){if(u=u.toFixed(2),u>=1e5){let t=u.toString(),a=t.indexOf("."),i=t,d="";return a!==-1&&(i=t.slice(0,a),d=t.slice(a)),i.slice(0,2)+".."+i.slice(-2)+d}return u}function du(){let u=localStorage.getItem("quota_per_unit");return u=parseFloat(u),u}function hn(u,t=6){let a=localStorage.getItem("quota_per_unit");return a=parseFloat(a),(u/a).toFixed(t)}function xe(u,t=2){let a=localStorage.getItem("quota_per_unit"),i=localStorage.getItem("display_in_currency");return a=parseFloat(a),i=i==="true",i?"$"+(u/a).toFixed(t):pu(u)}function uu(u,t){let a=localStorage.getItem("display_in_currency");return a=a==="true",a?`（等价金额：${xe(u,t)}）`:""}const Ou=["amber","blue","cyan","green","grey","indigo","light-blue","lime","orange","pink","purple","red","teal","violet","yellow"],Fn={"dall-e":"rgb(147,112,219)","dall-e-2":"rgb(147,112,219)","dall-e-3":"rgb(153,50,204)",midjourney:"rgb(136,43,180)","gpt-3.5-turbo":"rgb(184,227,167)","gpt-3.5-turbo-0301":"rgb(131,220,131)","gpt-3.5-turbo-0613":"rgb(60,179,113)","gpt-3.5-turbo-1106":"rgb(32,178,170)","gpt-3.5-turbo-16k":"rgb(252,200,149)","gpt-3.5-turbo-16k-0613":"rgb(255,181,119)","gpt-3.5-turbo-instruct":"rgb(175,238,238)","gpt-4":"rgb(135,206,235)","gpt-4-0314":"rgb(70,130,180)","gpt-4-0613":"rgb(100,149,237)","gpt-4-1106-preview":"rgb(30,144,255)","gpt-4-0125-preview":"rgb(2,177,236)","gpt-4-turbo-preview":"rgb(2,177,255)","gpt-4-32k":"rgb(104,111,238)","gpt-4-32k-0314":"rgb(90,105,205)","gpt-4-32k-0613":"rgb(61,71,139)","gpt-4-all":"rgb(65,105,225)","gpt-4-gizmo-*":"rgb(0,0,255)","gpt-4-vision-preview":"rgb(25,25,112)","text-ada-001":"rgb(255,192,203)","text-babbage-001":"rgb(255,160,122)","text-curie-001":"rgb(219,112,147)","text-davinci-002":"rgb(199,21,133)","text-davinci-003":"rgb(219,112,147)","text-davinci-edit-001":"rgb(255,105,180)","text-embedding-ada-002":"rgb(255,182,193)","text-embedding-v1":"rgb(255,174,185)","text-moderation-latest":"rgb(255,130,171)","text-moderation-stable":"rgb(255,160,122)","tts-1":"rgb(255,140,0)","tts-1-1106":"rgb(255,165,0)","tts-1-hd":"rgb(255,215,0)","tts-1-hd-1106":"rgb(255,223,0)","whisper-1":"rgb(245,245,220)"};function tu(u){let t=0;for(let i=0;i<u.length;i++)t+=u.charCodeAt(i);let a=t%Ou.length;return Ou[a]}const Zt=u=>{const t={username:"",display_name:"",password:""},[a,i]=s.useState(t),[d,c]=s.useState(!1),{username:p,display_name:B,password:b}=a,_=(F,j)=>{i(o=>({...o,[F]:j}))},P=async()=>{if(c(!0),a.username===""||a.password==="")return;const F=await v.post("/api/user/",a),{success:j,message:o}=F.data;j?(Z("用户账户创建成功！"),i(t),u.refresh(),u.handleClose()):E(o),c(!1)},x=()=>{u.handleClose()};return e.jsx(e.Fragment,{children:e.jsx(nu,{placement:"left",title:e.jsx(Ue,{level:3,children:"添加用户"}),headerStyle:{borderBottom:"1px solid var(--semi-color-border)"},bodyStyle:{borderBottom:"1px solid var(--semi-color-border)"},visible:u.visible,footer:e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(ce,{children:[e.jsx(w,{theme:"solid",size:"large",onClick:P,children:"提交"}),e.jsx(w,{theme:"solid",size:"large",type:"tertiary",onClick:x,children:"取消"})]})}),closeIcon:null,onCancel:()=>x(),width:Be()?"100%":600,children:e.jsxs(Ge,{spinning:d,children:[e.jsx(te,{style:{marginTop:20},label:"用户名",name:"username",addonBefore:"用户名",placeholder:"请输入用户名",onChange:F=>_("username",F),value:p,autoComplete:"off"}),e.jsx(te,{style:{marginTop:20},addonBefore:"显示名",label:"显示名称",name:"display_name",autoComplete:"off",placeholder:"请输入显示名称",onChange:F=>_("display_name",F),value:B}),e.jsx(te,{style:{marginTop:20},label:"密 码",name:"password",type:"password",addonBefore:"密码",placeholder:"请输入密码",onChange:F=>_("password",F),value:b,autoComplete:"off"})]})})})},wu=u=>{const t=u.editingUser.id,[a,i]=s.useState(!0),[d,c]=s.useState({username:"",display_name:"",password:"",github_id:"",wechat_id:"",email:"",quota:0,group:"default"}),[p,B]=s.useState([]),{username:b,display_name:_,password:P,github_id:x,wechat_id:F,telegram_id:j,email:o,quota:k,group:T}=d,m=(I,Q)=>{c($=>({...$,[I]:Q}))},L=async()=>{try{let I=await v.get("/api/group/");B(I.data.data.map(Q=>({label:Q,value:Q})))}catch(I){E(I.message)}};_e();const G=()=>{u.handleClose()},K=async()=>{i(!0);let I;t?I=await v.get(`/api/user/${t}`):I=await v.get("/api/user/self");const{success:Q,message:$,data:y}=I.data;Q?(y.password="",c(y)):E($),i(!1)};s.useEffect(()=>{K().then(),t&&L().then()},[u.editingUser.id]);const U=async()=>{i(!0);let I;if(t){let y={...d,id:parseInt(t)};typeof y.quota=="string"&&(y.quota=parseInt(y.quota)),I=await v.put("/api/user/",y)}else I=await v.put("/api/user/self",d);const{success:Q,message:$}=I.data;Q?(Z("用户信息更新成功！"),u.refresh(),u.handleClose()):E($),i(!1)};return e.jsx(e.Fragment,{children:e.jsx(nu,{placement:"right",title:e.jsx(Ue,{level:3,children:"编辑用户"}),headerStyle:{borderBottom:"1px solid var(--semi-color-border)"},bodyStyle:{borderBottom:"1px solid var(--semi-color-border)"},visible:u.visible,footer:e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(ce,{children:[e.jsx(w,{theme:"solid",size:"large",onClick:U,children:"提交"}),e.jsx(w,{theme:"solid",size:"large",type:"tertiary",onClick:G,children:"取消"})]})}),closeIcon:null,onCancel:()=>G(),width:Be()?"100%":600,children:e.jsxs(Ge,{spinning:a,children:[e.jsx("div",{style:{marginTop:20},children:e.jsx(Y.Text,{children:"用户名"})}),e.jsx(te,{label:"用户名",name:"username",placeholder:"请输入新的用户名",onChange:I=>m("username",I),value:b,autoComplete:"new-password"}),e.jsx("div",{style:{marginTop:20},children:e.jsx(Y.Text,{children:"密码"})}),e.jsx(te,{label:"密码",name:"password",type:"password",placeholder:"请输入新的密码，最短 8 位",onChange:I=>m("password",I),value:P,autoComplete:"new-password"}),e.jsx("div",{style:{marginTop:20},children:e.jsx(Y.Text,{children:"显示名称"})}),e.jsx(te,{label:"显示名称",name:"display_name",placeholder:"请输入新的显示名称",onChange:I=>m("display_name",I),value:_,autoComplete:"new-password"}),t&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:20},children:e.jsx(Y.Text,{children:"分组"})}),e.jsx(De,{placeholder:"请选择分组",name:"group",fluid:!0,search:!0,selection:!0,allowAdditions:!0,additionLabel:"请在系统设置页面编辑分组倍率以添加新的分组：",onChange:I=>m("group",I),value:d.group,autoComplete:"new-password",optionList:p}),e.jsx("div",{style:{marginTop:20},children:e.jsx(Y.Text,{children:`剩余额度${uu(k)}`})}),e.jsx(te,{name:"quota",placeholder:"请输入新的剩余额度",onChange:I=>m("quota",I),value:k,type:"number",autoComplete:"new-password"})]}),e.jsx(Fu,{style:{marginTop:20},children:"以下信息不可修改"}),e.jsx("div",{style:{marginTop:20},children:e.jsx(Y.Text,{children:"已绑定的 GitHub 账户"})}),e.jsx(te,{name:"github_id",value:x,autoComplete:"new-password",placeholder:"此项只读，需要用户通过个人设置页面的相关绑定按钮进行绑定，不可直接修改",readonly:!0}),e.jsx("div",{style:{marginTop:20},children:e.jsx(Y.Text,{children:"已绑定的微信账户"})}),e.jsx(te,{name:"wechat_id",value:F,autoComplete:"new-password",placeholder:"此项只读，需要用户通过个人设置页面的相关绑定按钮进行绑定，不可直接修改",readonly:!0}),e.jsx(te,{name:"telegram_id",value:j,autoComplete:"new-password",placeholder:"此项只读，需要用户通过个人设置页面的相关绑定按钮进行绑定，不可直接修改",readonly:!0}),e.jsx("div",{style:{marginTop:20},children:e.jsx(Y.Text,{children:"已绑定的邮箱账户"})}),e.jsx(te,{name:"email",value:o,autoComplete:"new-password",placeholder:"此项只读，需要用户通过个人设置页面的相关绑定按钮进行绑定，不可直接修改",readonly:!0})]})})})};function Xt(u){switch(u){case 1:return e.jsx(D,{size:"large",children:"普通用户"});case 10:return e.jsx(D,{color:"yellow",size:"large",children:"管理员"});case 100:return e.jsx(D,{color:"orange",size:"large",children:"超级管理员"});default:return e.jsx(D,{color:"red",size:"large",children:"未知身份"})}}const es=()=>{const u=[{title:"ID",dataIndex:"id"},{title:"用户名",dataIndex:"username"},{title:"分组",dataIndex:"group",render:(l,r,n)=>e.jsx("div",{children:ut(l)})},{title:"统计信息",dataIndex:"info",render:(l,r,n)=>e.jsx("div",{children:e.jsxs(ce,{spacing:1,children:[e.jsx(Le,{content:"剩余额度",children:e.jsx(D,{color:"white",size:"large",children:xe(r.quota)})}),e.jsx(Le,{content:"已用额度",children:e.jsx(D,{color:"white",size:"large",children:xe(r.used_quota)})}),e.jsx(Le,{content:"调用次数",children:e.jsx(D,{color:"white",size:"large",children:pu(r.request_count)})})]})})},{title:"邀请信息",dataIndex:"invite",render:(l,r,n)=>e.jsx("div",{children:e.jsxs(ce,{spacing:1,children:[e.jsx(Le,{content:"邀请人数",children:e.jsx(D,{color:"white",size:"large",children:pu(r.aff_count)})}),e.jsx(Le,{content:"邀请总收益",children:e.jsx(D,{color:"white",size:"large",children:xe(r.aff_history_quota)})}),e.jsx(Le,{content:"邀请人ID",children:r.inviter_id===0?e.jsx(D,{color:"white",size:"large",children:"无"}):e.jsx(D,{color:"white",size:"large",children:r.inviter_id})})]})})},{title:"角色",dataIndex:"role",render:(l,r,n)=>e.jsx("div",{children:Xt(l)})},{title:"状态",dataIndex:"status",render:(l,r,n)=>e.jsx("div",{children:r.DeletedAt!==null?e.jsx(D,{color:"red",children:"已注销"}):Q(l)})},{title:"",dataIndex:"operate",render:(l,r,n)=>e.jsxs("div",{children:[r.DeletedAt!==null?e.jsx(e.Fragment,{}):e.jsxs(e.Fragment,{children:[e.jsx(Ae,{title:"确定？",okType:"warning",onConfirm:()=>{I(r.username,"promote",r)},children:e.jsx(w,{theme:"light",type:"warning",style:{marginRight:1},children:"提升"})}),e.jsx(Ae,{title:"确定？",okType:"warning",onConfirm:()=>{I(r.username,"demote",r)},children:e.jsx(w,{theme:"light",type:"secondary",style:{marginRight:1},children:"降级"})}),r.status===1?e.jsx(w,{theme:"light",type:"warning",style:{marginRight:1},onClick:async()=>{I(r.username,"disable",r)},children:"禁用"}):e.jsx(w,{theme:"light",type:"secondary",style:{marginRight:1},onClick:async()=>{I(r.username,"enable",r)},disabled:r.status===3,children:"启用"}),e.jsx(w,{theme:"light",type:"tertiary",style:{marginRight:1},onClick:()=>{L(r),T(!0)},children:"编辑"})]}),e.jsx(Ae,{title:"确定是否要删除此用户？",content:"硬删除，此修改将不可逆",okType:"danger",position:"left",onConfirm:()=>{I(r.username,"delete",r).then(()=>{K(r.id)})},children:e.jsx(w,{theme:"light",type:"danger",style:{marginRight:1},children:"删除"})})]})}],[t,a]=s.useState([]),[i,d]=s.useState(!0),[c,p]=s.useState(1),[B,b]=s.useState(""),[_,P]=s.useState(!1),[x,F]=s.useState(ie),[j,o]=s.useState(!1),[k,T]=s.useState(!1),[m,L]=s.useState({id:void 0}),G=l=>{l.length>=c*ie?F(l.length+1):F(l.length)},K=l=>{console.log(l);let r=[...t];if(l!=null){let n=r.findIndex(M=>M.id===l);n>-1&&(r.splice(n,1),a(r))}},U=async l=>{const r=await v.get(`/api/user/?p=${l}`),{success:n,message:M,data:V}=r.data;if(n)if(l===0)a(V),G(V);else{let C=t;C.push(...V),a(C),G(C)}else E(M);d(!1)};s.useEffect(()=>{U(0).then().catch(l=>{E(l)})},[]);const I=async(l,r,n)=>{const M=await v.post("/api/user/manage",{username:l,action:r}),{success:V,message:C}=M.data;if(V){Z("操作成功完成！");let q=M.data.data,A=[...t];r==="delete"||(n.status=q.status,n.role=q.role),a(A)}else E(C)},Q=l=>{switch(l){case 1:return e.jsx(D,{size:"large",children:"已激活"});case 2:return e.jsx(D,{size:"large",color:"red",children:"已封禁"});default:return e.jsx(D,{size:"large",color:"grey",children:"未知状态"})}},$=async()=>{if(B===""){await U(0),p(1);return}P(!0);const l=await v.get(`/api/user/search?keyword=${B}`),{success:r,message:n,data:M}=l.data;r?(a(M),p(1)):E(n),P(!1)},y=async l=>{b(l.trim())},ue=l=>{p(l),l===Math.ceil(t.length/ie)+1&&U(l-1).then(r=>{})},R=t.slice((c-1)*ie,c*ie),J=()=>{o(!1)},z=()=>{T(!1),L({id:void 0})},H=async()=>{B===""?await U(c-1):await $()};return e.jsxs(e.Fragment,{children:[e.jsx(Zt,{refresh:H,visible:j,handleClose:J}),e.jsx(wu,{refresh:H,visible:k,handleClose:z,editingUser:m}),e.jsx(X,{onSubmit:$,children:e.jsx(X.Input,{label:"搜索关键字",icon:"search",field:"keyword",iconPosition:"left",placeholder:"搜索用户的 ID，用户名，显示名称，以及邮箱地址 ...",value:B,loading:_,onChange:l=>y(l)})}),e.jsx(Je,{columns:u,dataSource:R,pagination:{currentPage:c,pageSize:ie,total:x,pageSizeOpts:[10,20,50,100],onPageChange:ue},loading:i}),e.jsx(w,{theme:"light",type:"primary",style:{marginRight:8},onClick:()=>{o(!0)},children:"添加用户"})]})},us=()=>e.jsx(e.Fragment,{children:e.jsxs(ae,{children:[e.jsx(ae.Header,{children:e.jsx("h3",{children:"管理用户"})}),e.jsx(ae.Content,{children:e.jsx(es,{})})]})});function Ie({children:u}){return localStorage.getItem("user")?u:e.jsx(rt,{to:"/login",state:{from:Kt.location}})}const ts=()=>{const[u,t]=s.useState({username:"",password:"",password2:"",email:"",verification_code:""}),{username:a,password:i,password2:d}=u,[c,p]=s.useState(!1),[B,b]=s.useState(!1),[_,P]=s.useState(""),[x,F]=s.useState(""),[j,o]=s.useState(!1),k=lu();let T=new URLSearchParams(window.location.search).get("aff");T&&localStorage.setItem("aff",T),s.useEffect(()=>{let U=localStorage.getItem("status");U&&(U=JSON.parse(U),p(U.email_verification),U.turnstile_check&&(b(!0),P(U.turnstile_site_key)))});let m=_e();function L(U){const{name:I,value:Q}=U.target;console.log(I,Q),t($=>({...$,[I]:Q}))}async function G(U){if(i.length<8){je("密码长度不得小于 8 位！");return}if(i!==d){je("两次输入的密码不一致");return}if(a&&i){if(B&&x===""){je("请稍后几秒重试，Turnstile 正在检查用户环境！");return}o(!0),T||(T=localStorage.getItem("aff")),u.aff_code=T;const I=await v.post(`/api/user/register?turnstile=${x}`,u),{success:Q,message:$}=I.data;Q?(m("/login"),Z("注册成功！")):E($),o(!1)}}const K=async()=>{if(u.email==="")return;if(B&&x===""){je("请稍后几秒重试，Turnstile 正在检查用户环境！");return}o(!0);const U=await v.get(`/api/verification?email=${u.email}&turnstile=${x}`),{success:I,message:Q}=U.data;I?Z("验证码发送成功，请检查你的邮箱！"):E(Q),o(!1)};return e.jsx(ke,{textAlign:"center",style:{marginTop:"48px"},children:e.jsxs(ke.Column,{style:{maxWidth:450},children:[e.jsxs(oe,{as:"h2",color:"",textAlign:"center",children:[e.jsx(_u,{src:k})," 新用户注册"]}),e.jsx(h,{size:"large",children:e.jsxs(gu,{children:[e.jsx(h.Input,{fluid:!0,icon:"user",iconPosition:"left",placeholder:"输入用户名，最长 12 位",onChange:L,name:"username"}),e.jsx(h.Input,{fluid:!0,icon:"lock",iconPosition:"left",placeholder:"输入密码，最短 8 位，最长 20 位",onChange:L,name:"password",type:"password"}),e.jsx(h.Input,{fluid:!0,icon:"lock",iconPosition:"left",placeholder:"输入密码，最短 8 位，最长 20 位",onChange:L,name:"password2",type:"password"}),c?e.jsxs(e.Fragment,{children:[e.jsx(h.Input,{fluid:!0,icon:"mail",iconPosition:"left",placeholder:"输入邮箱地址",onChange:L,name:"email",type:"email",action:e.jsx(Ne,{onClick:K,disabled:j,children:"获取验证码"})}),e.jsx(h.Input,{fluid:!0,icon:"lock",iconPosition:"left",placeholder:"输入验证码",onChange:L,name:"verification_code"})]}):e.jsx(e.Fragment,{}),B?e.jsx(Qe,{sitekey:_,onVerify:U=>{F(U)}}):e.jsx(e.Fragment,{}),e.jsx(Ne,{color:"green",fluid:!0,size:"large",onClick:G,loading:j,children:"注册"})]})}),e.jsxs(mu,{children:["已有账户？",e.jsx(eu,{to:"/login",className:"btn btn-link",children:"点击登录"})]})]})})},ss=(u,t)=>{switch(t.type){case"login":return{...u,user:t.payload};case"logout":return{...u,user:void 0};default:return u}},tt={user:void 0},We=su.createContext({state:tt,dispatch:()=>null}),ns=({children:u})=>{const[t,a]=su.useReducer(ss,tt);return e.jsx(We.Provider,{value:[t,a],children:u})};async function as(){const u=await v.get("/api/oauth/state"),{success:t,message:a,data:i}=u.data;return t?i:(E(a),"")}async function st(u){const t=await as();t&&window.open(`https://github.com/login/oauth/authorize?client_id=${u}&state=${t}&scope=user:email`)}const ls=()=>{function u(){return e.jsxs("svg",{t:"1709714447384",className:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"5091",width:"16",height:"16",children:[e.jsx("path",{d:"M690.1 377.4c5.9 0 11.8 0.2 17.6 0.5-24.4-128.7-158.3-227.1-319.9-227.1C209 150.8 64 271.4 64 420.2c0 81.1 43.6 154.2 111.9 203.6 5.5 3.9 9.1 10.3 9.1 17.6 0 2.4-0.5 4.6-1.1 6.9-5.5 20.3-14.2 52.8-14.6 54.3-0.7 2.6-1.7 5.2-1.7 7.9 0 5.9 4.8 10.8 10.8 10.8 2.3 0 4.2-0.9 6.2-2l70.9-40.9c5.3-3.1 11-5 17.2-5 3.2 0 6.4 0.5 9.5 1.4 33.1 9.5 68.8 14.8 105.7 14.8 6 0 11.9-0.1 17.8-0.4-7.1-21-10.9-43.1-10.9-66 0-135.8 132.2-245.8 295.3-245.8z m-194.3-86.5c23.8 0 43.2 19.3 43.2 43.1s-19.3 43.1-43.2 43.1c-23.8 0-43.2-19.3-43.2-43.1s19.4-43.1 43.2-43.1z m-215.9 86.2c-23.8 0-43.2-19.3-43.2-43.1s19.3-43.1 43.2-43.1 43.2 19.3 43.2 43.1-19.4 43.1-43.2 43.1z","p-id":"5092"}),e.jsx("path",{d:"M866.7 792.7c56.9-41.2 93.2-102 93.2-169.7 0-124-120.8-224.5-269.9-224.5-149 0-269.9 100.5-269.9 224.5S540.9 847.5 690 847.5c30.8 0 60.6-4.4 88.1-12.3 2.6-0.8 5.2-1.2 7.9-1.2 5.2 0 9.9 1.6 14.3 4.1l59.1 34c1.7 1 3.3 1.7 5.2 1.7 2.4 0 4.7-0.9 6.4-2.6 1.7-1.7 2.6-4 2.6-6.4 0-2.2-0.9-4.4-1.4-6.6-0.3-1.2-7.6-28.3-12.2-45.3-0.5-1.9-0.9-3.8-0.9-5.7 0.1-5.9 3.1-11.2 7.6-14.5zM600.2 587.2c-19.9 0-36-16.1-36-35.9 0-19.8 16.1-35.9 36-35.9s36 16.1 36 35.9c0 19.8-16.2 35.9-36 35.9z m179.9 0c-19.9 0-36-16.1-36-35.9 0-19.8 16.1-35.9 36-35.9s36 16.1 36 35.9c-0.1 19.8-16.2 35.9-36 35.9z","p-id":"5093"})]})}return e.jsx("div",{children:e.jsx(Wu,{svg:e.jsx(u,{})})})},is=()=>{const[u,t]=s.useState({username:"",password:"",wechat_verification_code:""}),[a,i]=vu(),[d,c]=s.useState(!1),{username:p,password:B}=u,[b,_]=s.useContext(We),[P,x]=s.useState(!1),[F,j]=s.useState(""),[o,k]=s.useState(""),[T,m]=s.useState(!1),[L,G]=s.useState(!1);let K=_e();const[U,I]=s.useState({});lu(),s.useEffect(()=>{a.get("expired")&&E("未登录或登录已过期，请重新登录！");let H=localStorage.getItem("status");H&&(H=JSON.parse(H),I(H),H.turnstile_check&&(x(!0),G(!0),j(H.turnstile_site_key)))},[]);const[Q,$]=s.useState(!1),y=()=>{$(!0)},ue=async()=>{if(P&&o===""){je("请稍后几秒重试，Turnstile 正在检查用户环境！");return}const H=await v.get(`/api/oauth/wechat?code=${u.wechat_verification_code}`),{success:l,message:r,data:n}=H.data;l?(_({type:"login",payload:n}),localStorage.setItem("user",JSON.stringify(n)),K("/"),Z("登录成功！"),$(!1)):E(r)};function R(H,l){t(r=>({...r,[H]:l}))}async function J(H){if(P&&o===""){je("请稍后几秒重试，Turnstile 正在检查用户环境！");return}if(c(!0),p&&B){m(!0);const l=await v.post(`/api/user/login?turnstile=${o}`,{username:p,password:B}),{success:r,message:n,data:M}=l.data;r?(_({type:"login",payload:M}),localStorage.setItem("user",JSON.stringify(M)),Z("登录成功！"),p==="root"&&B==="123456"&&fe.error({title:"您正在使用默认密码！",content:"请立刻修改默认密码！",centered:!0}),K("/token")):(E(n),m(!1))}else E("请输入用户名和密码！")}const z=async H=>{const l=["id","first_name","last_name","username","photo_url","auth_date","hash","lang"],r={};l.forEach(q=>{H[q]&&(r[q]=H[q])});const n=await v.get("/api/oauth/telegram/login",{params:r}),{success:M,message:V,data:C}=n.data;M?(_({type:"login",payload:C}),localStorage.setItem("user",JSON.stringify(C)),Z("登录成功！"),K("/")):E(V)};return e.jsx("div",{children:e.jsxs(ae,{children:[e.jsx(ae.Header,{}),e.jsx(ae.Content,{children:e.jsx("div",{style:{justifyContent:"center",display:"flex",marginTop:120},children:e.jsxs("div",{style:{width:500},children:[e.jsxs(qe,{children:[e.jsx(Ue,{heading:2,style:{textAlign:"center"},children:"用户登录"}),e.jsxs(X,{children:[e.jsx(X.Input,{field:"username",label:"用户名",placeholder:"用户名",name:"username",onChange:H=>R("username",H)}),e.jsx(X.Input,{field:"password",label:"密码",placeholder:"密码",name:"password",type:"password",onChange:H=>R("password",H)}),e.jsx(w,{theme:"solid",style:{width:"100%"},type:"primary",size:"large",htmlType:"submit",onClick:J,disabled:L,loading:T,children:"登录"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:20},children:[e.jsxs(Iu,{children:["没有账号请先 ",e.jsx(eu,{to:"/register",children:"注册账号"})]}),e.jsxs(Iu,{children:["忘记密码 ",e.jsx(eu,{to:"/reset",children:"点击重置"})]})]}),U.github_oauth||U.wechat_login||U.telegram_oauth?e.jsxs(e.Fragment,{children:[e.jsx(Fu,{margin:"12px",align:"center",children:"第三方登录"}),e.jsxs("div",{style:{display:"flex",justifyContent:"center",marginTop:20},children:[U.github_oauth?e.jsx(w,{type:"primary",icon:e.jsx(ht,{}),onClick:()=>st(U.github_client_id)}):e.jsx(e.Fragment,{}),U.wechat_login?e.jsx(w,{type:"primary",style:{color:"rgba(var(--semi-green-5), 1)"},icon:e.jsx(Wu,{svg:e.jsx(ls,{})}),onClick:y}):e.jsx(e.Fragment,{}),U.telegram_oauth?e.jsx(Vu,{dataOnauth:z,botName:U.telegram_bot_name}):e.jsx(e.Fragment,{})]})]}):e.jsx(e.Fragment,{}),e.jsxs(fe,{title:"微信扫码登录",visible:Q,maskClosable:!0,onOk:ue,onCancel:()=>$(!1),okText:"登录",size:"small",centered:!0,children:[e.jsx("div",{style:{display:"flex",alignItem:"center",flexDirection:"column"},children:e.jsx("img",{src:U.wechat_qrcode})}),e.jsx("div",{style:{textAlign:"center"},children:e.jsx("p",{children:"微信扫码关注公众号，输入「验证码」获取验证码（三分钟内有效）"})}),e.jsx(X,{size:"large",children:e.jsx(X.Input,{field:"wechat_verification_code",placeholder:"验证码",label:"验证码",value:u.wechat_verification_code,onChange:H=>R("wechat_verification_code",H)})})]})]}),P?e.jsx("div",{style:{display:"flex",justifyContent:"center",marginTop:20},children:e.jsx(Qe,{sitekey:F,onVerify:H=>{k(H),G(!1)}})}):e.jsx(e.Fragment,{})]})})})]})})},rs=()=>e.jsx(e.Fragment,{children:e.jsxs(mu,{negative:!0,children:[e.jsx(mu.Header,{children:"页面不存在"}),e.jsx("p",{children:"请检查你的浏览器地址是否正确"})]})}),os=()=>{let[u,t]=s.useState({PasswordLoginEnabled:"",PasswordRegisterEnabled:"",EmailVerificationEnabled:"",GitHubOAuthEnabled:"",GitHubClientId:"",GitHubClientSecret:"",Notice:"",SMTPServer:"",SMTPPort:"",SMTPAccount:"",SMTPFrom:"",SMTPToken:"",ServerAddress:"",EpayId:"",EpayKey:"",Price:7.3,MinTopUp:1,TopupGroupRatio:"",PayAddress:"",CustomCallbackAddress:"",Footer:"",WeChatAuthEnabled:"",WeChatServerAddress:"",WeChatServerToken:"",WeChatAccountQRCodeImageURL:"",TurnstileCheckEnabled:"",TurnstileSiteKey:"",TurnstileSecretKey:"",RegisterEnabled:"",EmailDomainRestrictionEnabled:"",SMTPSSLEnabled:"",EmailDomainWhitelist:[],TelegramOAuthEnabled:"",TelegramBotToken:"",TelegramBotName:""});const[a,i]=s.useState({});let[d,c]=s.useState(!1);const[p,B]=s.useState([]),[b,_]=s.useState(""),[P,x]=s.useState(!1),F=async()=>{const $=await v.get("/api/option/"),{success:y,message:ue,data:R}=$.data;if(y){let J={};R.forEach(z=>{z.key==="TopupGroupRatio"&&(z.value=JSON.stringify(JSON.parse(z.value),null,2)),J[z.key]=z.value}),t({...J,EmailDomainWhitelist:J.EmailDomainWhitelist.split(",")}),i(J),B(J.EmailDomainWhitelist.split(",").map(z=>({key:z,text:z,value:z})))}else E(ue)};s.useEffect(()=>{F().then()},[]),s.useEffect(()=>{},[u.EmailDomainWhitelist]);const j=async($,y)=>{switch(c(!0),$){case"PasswordLoginEnabled":case"PasswordRegisterEnabled":case"EmailVerificationEnabled":case"GitHubOAuthEnabled":case"WeChatAuthEnabled":case"TelegramOAuthEnabled":case"TurnstileCheckEnabled":case"EmailDomainRestrictionEnabled":case"SMTPSSLEnabled":case"RegisterEnabled":y=u[$]==="true"?"false":"true";break}const ue=await v.put("/api/option/",{key:$,value:y}),{success:R,message:J}=ue.data;R?($==="EmailDomainWhitelist"&&(y=y.split(",")),$==="Price"&&(y=parseFloat(y)),t(z=>({...z,[$]:y}))):E(J),c(!1)},o=async($,{name:y,value:ue})=>{if(y==="PasswordLoginEnabled"&&u[y]==="true"){x(!0);return}y==="Notice"||y.startsWith("SMTP")&&y!=="SMTPSSLEnabled"||y==="ServerAddress"||y==="EpayId"||y==="EpayKey"||y==="Price"||y==="PayAddress"||y==="GitHubClientId"||y==="GitHubClientSecret"||y==="WeChatServerAddress"||y==="WeChatServerToken"||y==="WeChatAccountQRCodeImageURL"||y==="TurnstileSiteKey"||y==="TurnstileSecretKey"||y==="EmailDomainWhitelist"||y==="TopupGroupRatio"||y==="TelegramBotToken"||y==="TelegramBotName"?t(R=>({...R,[y]:ue})):await j(y,ue)},k=async()=>{let $=fu(u.ServerAddress);await j("ServerAddress",$)},T=async()=>{if(u.ServerAddress===""){E("请先填写服务器地址");return}if(a.TopupGroupRatio!==u.TopupGroupRatio){if(!Xe(u.TopupGroupRatio)){E("充值分组倍率不是合法的 JSON 字符串");return}await j("TopupGroupRatio",u.TopupGroupRatio)}let $=fu(u.PayAddress);await j("PayAddress",$),u.EpayId!==""&&await j("EpayId",u.EpayId),u.EpayKey!==""&&await j("EpayKey",u.EpayKey),await j("Price",""+u.Price)},m=async()=>{a.SMTPServer!==u.SMTPServer&&await j("SMTPServer",u.SMTPServer),a.SMTPAccount!==u.SMTPAccount&&await j("SMTPAccount",u.SMTPAccount),a.SMTPFrom!==u.SMTPFrom&&await j("SMTPFrom",u.SMTPFrom),a.SMTPPort!==u.SMTPPort&&u.SMTPPort!==""&&await j("SMTPPort",u.SMTPPort),a.SMTPToken!==u.SMTPToken&&u.SMTPToken!==""&&await j("SMTPToken",u.SMTPToken)},L=async()=>{a.EmailDomainWhitelist!==u.EmailDomainWhitelist.join(",")&&u.SMTPToken!==""&&await j("EmailDomainWhitelist",u.EmailDomainWhitelist.join(","))},G=async()=>{a.WeChatServerAddress!==u.WeChatServerAddress&&await j("WeChatServerAddress",fu(u.WeChatServerAddress)),a.WeChatAccountQRCodeImageURL!==u.WeChatAccountQRCodeImageURL&&await j("WeChatAccountQRCodeImageURL",u.WeChatAccountQRCodeImageURL),a.WeChatServerToken!==u.WeChatServerToken&&u.WeChatServerToken!==""&&await j("WeChatServerToken",u.WeChatServerToken)},K=async()=>{a.GitHubClientId!==u.GitHubClientId&&await j("GitHubClientId",u.GitHubClientId),a.GitHubClientSecret!==u.GitHubClientSecret&&u.GitHubClientSecret!==""&&await j("GitHubClientSecret",u.GitHubClientSecret)},U=async()=>{await j("TelegramBotToken",u.TelegramBotToken),await j("TelegramBotName",u.TelegramBotName)},I=async()=>{a.TurnstileSiteKey!==u.TurnstileSiteKey&&await j("TurnstileSiteKey",u.TurnstileSiteKey),a.TurnstileSecretKey!==u.TurnstileSecretKey&&u.TurnstileSecretKey!==""&&await j("TurnstileSecretKey",u.TurnstileSecretKey)},Q=()=>{const $=u.EmailDomainWhitelist;b!==""&&!$.includes(b)&&(_(""),t({...u,EmailDomainWhitelist:[...$,b]}),B([...p,{key:b,text:b,value:b}]))};return e.jsx(ke,{columns:1,children:e.jsx(ke.Column,{children:e.jsxs(h,{loading:d,children:[e.jsx(oe,{as:"h3",children:"通用设置"}),e.jsx(h.Group,{widths:"equal",children:e.jsx(h.Input,{label:"服务器地址",placeholder:"例如：https://yourdomain.com",value:u.ServerAddress,name:"ServerAddress",onChange:o})}),e.jsx(h.Button,{onClick:k,children:"更新服务器地址"}),e.jsx(ge,{}),e.jsx(oe,{as:"h3",children:"支付设置（当前仅支持易支付接口，默认使用上方服务器地址作为回调地址！）"}),e.jsxs(h.Group,{widths:"equal",children:[e.jsx(h.Input,{label:"支付地址，不填写则不启用在线支付",placeholder:"例如：https://yourdomain.com",value:u.PayAddress,name:"PayAddress",onChange:o}),e.jsx(h.Input,{label:"易支付商户ID",placeholder:"例如：0001",value:u.EpayId,name:"EpayId",onChange:o}),e.jsx(h.Input,{label:"易支付商户密钥",placeholder:"例如：dejhfueqhujasjmndbjkqaw",value:u.EpayKey,name:"EpayKey",onChange:o})]}),e.jsxs(h.Group,{widths:"equal",children:[e.jsx(h.Input,{label:"回调地址，不填写则使用上方服务器地址作为回调地址",placeholder:"例如：https://yourdomain.com",value:u.CustomCallbackAddress,name:"CustomCallbackAddress",onChange:o}),e.jsx(h.Input,{label:"充值价格（x元/美金）",placeholder:"例如：7，就是7元/美金",value:u.Price,name:"Price",min:0,onChange:o}),e.jsx(h.Input,{label:"最低充值数量",placeholder:"例如：2，就是最低充值2$",value:u.MinTopUp,name:"MinTopUp",min:1,onChange:o})]}),e.jsx(h.Group,{widths:"equal",children:e.jsx(h.TextArea,{label:"充值分组倍率",name:"TopupGroupRatio",onChange:o,style:{minHeight:250,fontFamily:"JetBrains Mono, Consolas"},autoComplete:"new-password",value:u.TopupGroupRatio,placeholder:"为一个 JSON 文本，键为组名称，值为倍率"})}),e.jsx(h.Button,{onClick:T,children:"更新支付设置"}),e.jsx(ge,{}),e.jsx(oe,{as:"h3",children:"配置登录注册"}),e.jsxs(h.Group,{inline:!0,children:[e.jsx(h.Checkbox,{checked:u.PasswordLoginEnabled==="true",label:"允许通过密码进行登录",name:"PasswordLoginEnabled",onChange:o}),P&&e.jsxs(cu,{open:P,onClose:()=>x(!1),size:"tiny",style:{maxWidth:"450px"},children:[e.jsx(cu.Header,{children:"警告"}),e.jsx(cu.Content,{children:e.jsx("p",{children:"取消密码登录将导致所有未绑定其他登录方式的用户（包括管理员）无法通过密码登录，确认取消？"})}),e.jsxs(cu.Actions,{children:[e.jsx(Ne,{onClick:()=>x(!1),children:"取消"}),e.jsx(Ne,{color:"yellow",onClick:async()=>{x(!1),await j("PasswordLoginEnabled","false")},children:"确定"})]})]}),e.jsx(h.Checkbox,{checked:u.PasswordRegisterEnabled==="true",label:"允许通过密码进行注册",name:"PasswordRegisterEnabled",onChange:o}),e.jsx(h.Checkbox,{checked:u.EmailVerificationEnabled==="true",label:"通过密码注册时需要进行邮箱验证",name:"EmailVerificationEnabled",onChange:o}),e.jsx(h.Checkbox,{checked:u.GitHubOAuthEnabled==="true",label:"允许通过 GitHub 账户登录 & 注册",name:"GitHubOAuthEnabled",onChange:o}),e.jsx(h.Checkbox,{checked:u.WeChatAuthEnabled==="true",label:"允许通过微信登录 & 注册",name:"WeChatAuthEnabled",onChange:o}),e.jsx(h.Checkbox,{checked:u.TelegramOAuthEnabled==="true",label:"允许通过 Telegram 进行登录",name:"TelegramOAuthEnabled",onChange:o})]}),e.jsxs(h.Group,{inline:!0,children:[e.jsx(h.Checkbox,{checked:u.RegisterEnabled==="true",label:"允许新用户注册（此项为否时，新用户将无法以任何方式进行注册）",name:"RegisterEnabled",onChange:o}),e.jsx(h.Checkbox,{checked:u.TurnstileCheckEnabled==="true",label:"启用 Turnstile 用户校验",name:"TurnstileCheckEnabled",onChange:o})]}),e.jsx(ge,{}),e.jsxs(oe,{as:"h3",children:["配置邮箱域名白名单",e.jsx(oe.Subheader,{children:"用以防止恶意用户利用临时邮箱批量注册"})]}),e.jsx(h.Group,{widths:3,children:e.jsx(h.Checkbox,{label:"启用邮箱域名白名单",name:"EmailDomainRestrictionEnabled",onChange:o,checked:u.EmailDomainRestrictionEnabled==="true"})}),e.jsxs(h.Group,{widths:2,children:[e.jsx(h.Dropdown,{label:"允许的邮箱域名",placeholder:"允许的邮箱域名",name:"EmailDomainWhitelist",required:!0,fluid:!0,multiple:!0,selection:!0,onChange:o,value:u.EmailDomainWhitelist,autoComplete:"new-password",options:p}),e.jsx(h.Input,{label:"添加新的允许的邮箱域名",action:e.jsx(Ne,{type:"button",onClick:()=>{Q()},children:"填入"}),onKeyDown:$=>{$.key==="Enter"&&Q()},autoComplete:"new-password",placeholder:"输入新的允许的邮箱域名",value:b,onChange:($,{value:y})=>{_(y)}})]}),e.jsx(h.Button,{onClick:L,children:"保存邮箱域名白名单设置"}),e.jsx(ge,{}),e.jsxs(oe,{as:"h3",children:["配置 SMTP",e.jsx(oe.Subheader,{children:"用以支持系统的邮件发送"})]}),e.jsxs(h.Group,{widths:3,children:[e.jsx(h.Input,{label:"SMTP 服务器地址",name:"SMTPServer",onChange:o,autoComplete:"new-password",value:u.SMTPServer,placeholder:"例如：smtp.qq.com"}),e.jsx(h.Input,{label:"SMTP 端口",name:"SMTPPort",onChange:o,autoComplete:"new-password",value:u.SMTPPort,placeholder:"默认: 587"}),e.jsx(h.Input,{label:"SMTP 账户",name:"SMTPAccount",onChange:o,autoComplete:"new-password",value:u.SMTPAccount,placeholder:"通常是邮箱地址"})]}),e.jsxs(h.Group,{widths:3,children:[e.jsx(h.Input,{label:"SMTP 发送者邮箱",name:"SMTPFrom",onChange:o,autoComplete:"new-password",value:u.SMTPFrom,placeholder:"通常和邮箱地址保持一致"}),e.jsx(h.Input,{label:"SMTP 访问凭证",name:"SMTPToken",onChange:o,type:"password",autoComplete:"new-password",checked:u.RegisterEnabled==="true",placeholder:"敏感信息不会发送到前端显示"})]}),e.jsx(h.Group,{widths:3,children:e.jsx(h.Checkbox,{label:"启用SMTP SSL（465端口强制开启）",name:"SMTPSSLEnabled",onChange:o,checked:u.SMTPSSLEnabled==="true"})}),e.jsx(h.Button,{onClick:m,children:"保存 SMTP 设置"}),e.jsx(ge,{}),e.jsxs(oe,{as:"h3",children:["配置 GitHub OAuth App",e.jsxs(oe.Subheader,{children:["用以支持通过 GitHub 进行登录注册，",e.jsx("a",{href:"https://github.com/settings/developers",target:"_blank",rel:"noreferrer",children:"点击此处"}),"管理你的 GitHub OAuth App"]})]}),e.jsxs(mu,{children:["Homepage URL 填 ",e.jsx("code",{children:u.ServerAddress}),"，Authorization callback URL 填"," ",e.jsx("code",{children:`${u.ServerAddress}/oauth/github`})]}),e.jsxs(h.Group,{widths:3,children:[e.jsx(h.Input,{label:"GitHub Client ID",name:"GitHubClientId",onChange:o,autoComplete:"new-password",value:u.GitHubClientId,placeholder:"输入你注册的 GitHub OAuth APP 的 ID"}),e.jsx(h.Input,{label:"GitHub Client Secret",name:"GitHubClientSecret",onChange:o,type:"password",autoComplete:"new-password",value:u.GitHubClientSecret,placeholder:"敏感信息不会发送到前端显示"})]}),e.jsx(h.Button,{onClick:K,children:"保存 GitHub OAuth 设置"}),e.jsx(ge,{}),e.jsxs(oe,{as:"h3",children:["配置 WeChat Server",e.jsxs(oe.Subheader,{children:["用以支持通过微信进行登录注册，",e.jsx("a",{href:"https://github.com/songquanpeng/wechat-server",target:"_blank",rel:"noreferrer",children:"点击此处"}),"了解 WeChat Server"]})]}),e.jsxs(h.Group,{widths:3,children:[e.jsx(h.Input,{label:"WeChat Server 服务器地址",name:"WeChatServerAddress",placeholder:"例如：https://yourdomain.com",onChange:o,autoComplete:"new-password",value:u.WeChatServerAddress}),e.jsx(h.Input,{label:"WeChat Server 访问凭证",name:"WeChatServerToken",type:"password",onChange:o,autoComplete:"new-password",value:u.WeChatServerToken,placeholder:"敏感信息不会发送到前端显示"}),e.jsx(h.Input,{label:"微信公众号二维码图片链接",name:"WeChatAccountQRCodeImageURL",onChange:o,autoComplete:"new-password",value:u.WeChatAccountQRCodeImageURL,placeholder:"输入一个图片链接"})]}),e.jsx(h.Button,{onClick:G,children:"保存 WeChat Server 设置"}),e.jsx(ge,{}),e.jsx(oe,{as:"h3",children:"配置 Telegram 登录"}),e.jsxs(h.Group,{inline:!0,children:[e.jsx(h.Input,{label:"Telegram Bot Token",name:"TelegramBotToken",onChange:o,value:u.TelegramBotToken,placeholder:"输入你的 Telegram Bot Token"}),e.jsx(h.Input,{label:"Telegram Bot 名称",name:"TelegramBotName",onChange:o,value:u.TelegramBotName,placeholder:"输入你的 Telegram Bot 名称"})]}),e.jsx(h.Button,{onClick:U,children:"保存 Telegram 登录设置"}),e.jsx(ge,{}),e.jsxs(oe,{as:"h3",children:["配置 Turnstile",e.jsxs(oe.Subheader,{children:["用以支持用户校验，",e.jsx("a",{href:"https://dash.cloudflare.com/",target:"_blank",rel:"noreferrer",children:"点击此处"}),"管理你的 Turnstile Sites，推荐选择 Invisible Widget Type"]})]}),e.jsxs(h.Group,{widths:3,children:[e.jsx(h.Input,{label:"Turnstile Site Key",name:"TurnstileSiteKey",onChange:o,autoComplete:"new-password",value:u.TurnstileSiteKey,placeholder:"输入你注册的 Turnstile Site Key"}),e.jsx(h.Input,{label:"Turnstile Secret Key",name:"TurnstileSecretKey",onChange:o,type:"password",autoComplete:"new-password",value:u.TurnstileSecretKey,placeholder:"敏感信息不会发送到前端显示"})]}),e.jsx(h.Button,{onClick:I,children:"保存 Turnstile 设置"})]})})})},cs=()=>{let[u,t]=s.useState({Notice:"",SystemName:"",Logo:"",Footer:"",About:"",HomePageContent:""}),[a,i]=s.useState(!1);s.useState(!1),s.useState({tag_name:"",content:""});const d=async(m,L)=>{i(!0);const G=await v.put("/api/option/",{key:m,value:L}),{success:K,message:U}=G.data;K?t(I=>({...I,[m]:L})):E(U),i(!1)},[c,p]=s.useState({Notice:!1,SystemName:!1,Logo:!1,HomePageContent:!1,About:!1,Footer:!1}),B=async(m,L)=>{const G=L.target.id;t(K=>({...K,[G]:m}))},b=s.useRef(),_=async()=>{try{p(m=>({...m,Notice:!0})),await d("Notice",u.Notice),Z("公告已更新")}catch(m){console.error("公告更新失败",m),E("公告更新失败")}finally{p(m=>({...m,Notice:!1}))}},P=s.useRef(),x=async()=>{try{p(m=>({...m,SystemName:!0})),await d("SystemName",u.SystemName),Z("系统名称已更新")}catch(m){console.error("系统名称更新失败",m),E("系统名称更新失败")}finally{p(m=>({...m,SystemName:!1}))}},F=async()=>{try{p(m=>({...m,Logo:!0})),await d("Logo",u.Logo),Z("Logo 已更新")}catch(m){console.error("Logo 更新失败",m),E("Logo 更新失败")}finally{p(m=>({...m,Logo:!1}))}},j=async m=>{try{p(L=>({...L,HomePageContent:!0})),await d(m,u[m]),Z("首页内容已更新")}catch(L){console.error("首页内容更新失败",L),E("首页内容更新失败")}finally{p(L=>({...L,HomePageContent:!1}))}},o=async()=>{try{p(m=>({...m,About:!0})),await d("About",u.About),Z("关于内容已更新")}catch(m){console.error("关于内容更新失败",m),E("关于内容更新失败")}finally{p(m=>({...m,About:!1}))}},k=async()=>{try{p(m=>({...m,Footer:!0})),await d("Footer",u.Footer),Z("页脚内容已更新")}catch(m){console.error("页脚内容更新失败",m),E("页脚内容更新失败")}finally{p(m=>({...m,Footer:!1}))}},T=async()=>{const m=await v.get("/api/option/"),{success:L,message:G,data:K}=m.data;if(L){let U={};K.forEach(I=>{I.key in u&&(U[I.key]=I.value)}),t(U),b.current.setValues(U),P.current.setValues(U)}else E(G)};return s.useEffect(()=>{T()},[]),e.jsx(Ft,{children:e.jsxs(mt,{span:24,children:[e.jsx(X,{values:u,getFormApi:m=>b.current=m,style:{marginBottom:15},children:e.jsxs(X.Section,{text:"通用设置",children:[e.jsx(X.TextArea,{label:"公告",placeholder:"在此输入新的公告内容，支持 Markdown & HTML 代码",field:"Notice",onChange:B,style:{fontFamily:"JetBrains Mono, Consolas"},autosize:{minRows:6,maxRows:12}}),e.jsx(w,{onClick:_,loading:c.Notice,children:"设置公告"})]})}),e.jsx(X,{values:u,getFormApi:m=>P.current=m,style:{marginBottom:15},children:e.jsxs(X.Section,{text:"个性化设置",children:[e.jsx(X.Input,{label:"系统名称",placeholder:"在此输入系统名称",field:"SystemName",onChange:B}),e.jsx(w,{onClick:x,loading:c.SystemName,children:"设置系统名称"}),e.jsx(X.Input,{label:"Logo 图片地址",placeholder:"在此输入 Logo 图片地址",field:"Logo",onChange:B}),e.jsx(w,{onClick:F,loading:c.Logo,children:"设置 Logo"}),e.jsx(X.TextArea,{label:"首页内容",placeholder:"在此输入首页内容，支持 Markdown & HTML 代码，设置后首页的状态信息将不再显示。如果输入的是一个链接，则会使用该链接作为 iframe 的 src 属性，这允许你设置任意网页作为首页。",field:"HomePageContent",onChange:B,style:{fontFamily:"JetBrains Mono, Consolas"},autosize:{minRows:6,maxRows:12}}),e.jsx(w,{onClick:()=>j("HomePageContent"),loading:c.HomePageContent,children:"设置首页内容"}),e.jsx(X.TextArea,{label:"关于",placeholder:"在此输入新的关于内容，支持 Markdown & HTML 代码。如果输入的是一个链接，则会使用该链接作为 iframe 的 src 属性，这允许你设置任意网页作为关于页面。",field:"About",onChange:B,style:{fontFamily:"JetBrains Mono, Consolas"},autosize:{minRows:6,maxRows:12}}),e.jsx(w,{onClick:o,loading:c.About,children:"设置关于"}),e.jsx(au,{fullMode:!1,type:"info",description:"移除 One API 的版权标识必须首先获得授权，项目维护需要花费大量精力，如果本项目对你有意义，请主动支持本项目。",closeIcon:null,style:{marginTop:15}}),e.jsx(X.Input,{label:"页脚",placeholder:"在此输入新的页脚，留空则使用默认页脚，支持 HTML 代码",field:"Footer",onChange:B}),e.jsx(w,{onClick:k,loading:c.Footer,children:"设置页脚"})]})})]})})},ds=()=>{var iu,f,S,ee,le,re,Ee,ve,Oe,ru,ou;const[u,t]=s.useContext(We);let a=_e();const[i,d]=s.useState({wechat_verification_code:"",email_verification_code:"",email:"",self_account_deletion_confirmation:"",set_new_password:"",set_new_password_confirmation:""}),[c,p]=s.useState({}),[B,b]=s.useState(!1),[_,P]=s.useState(!1),[x,F]=s.useState(!1),[j,o]=s.useState(!1),[k,T]=s.useState(!1),[m,L]=s.useState(""),[G,K]=s.useState(""),[U,I]=s.useState(!1),[Q,$]=s.useState(!1),[y,ue]=s.useState(30),[R,J]=s.useState(""),[z,H]=s.useState(""),[l,r]=s.useState([]),[n,M]=s.useState(!1),[V,C]=s.useState(0);s.useEffect(()=>{let N=localStorage.getItem("status");N&&(N=JSON.parse(N),p(N),N.turnstile_check&&(T(!0),L(N.turnstile_site_key))),ne().then(de=>{console.log(u)}),g().then(),W().then(),C(du())},[]),s.useEffect(()=>{let N=null;return Q&&y>0?N=setInterval(()=>{ue(y-1)},1e3):y===0&&($(!1),ue(30)),()=>clearInterval(N)},[Q,y]);const q=(N,de)=>{d(he=>({...he,[N]:de}))},A=async()=>{const N=await v.get("/api/user/token"),{success:de,message:he,data:Te}=N.data;de?(H(Te),await Re(Te),Z("令牌已重置并已复制到剪贴板")):E(he)},W=async()=>{const N=await v.get("/api/user/aff"),{success:de,message:he,data:Te}=N.data;if(de){let lt=`${window.location.origin}/register?aff=${Te}`;J(lt)}else E(he)},ne=async()=>{let N=await v.get("/api/user/self");const{success:de,message:he,data:Te}=N.data;de?t({type:"login",payload:Te}):E(he)},g=async()=>{let N=await v.get("/api/user/models");const{success:de,message:he,data:Te}=N.data;de?(r(Te),console.log(Te)):E(he)},O=async N=>{N.target.select(),await Re(N.target.value),Z("邀请链接已复制到剪切板")},se=async N=>{N.target.select(),await Re(N.target.value),Z("系统令牌已复制到剪切板")},me=async()=>{if(i.self_account_deletion_confirmation!==u.user.username){E("请输入你的账户名以确认删除！");return}const N=await v.delete("/api/user/self"),{success:de,message:he}=N.data;de?(Z("账户已删除！"),await v.get("/api/user/logout"),t({type:"logout"}),localStorage.removeItem("user"),a("/login")):E(he)},pe=async()=>{if(i.wechat_verification_code==="")return;const N=await v.get(`/api/oauth/wechat/bind?code=${i.wechat_verification_code}`),{success:de,message:he}=N.data;de?(Z("微信账户绑定成功！"),P(!1)):E(he)},Ce=async()=>{if(i.set_new_password!==i.set_new_password_confirmation){E("两次输入的密码不一致！");return}const N=await v.put("/api/user/self",{password:i.set_new_password}),{success:de,message:he}=N.data;de?(Z("密码修改成功！"),P(!1)):E(he),b(!1)},Ve=async()=>{if(V<du()){E("划转金额最低为"+xe(du()));return}const N=await v.post("/api/user/aff_transfer",{quota:V}),{success:de,message:he}=N.data;de?(Z(he),M(!1),ne().then()):E(he)},Ye=async()=>{if(i.email===""){E("请输入邮箱！");return}if($(!0),k&&G===""){je("请稍后几秒重试，Turnstile 正在检查用户环境！");return}I(!0);const N=await v.get(`/api/verification?email=${i.email}&turnstile=${G}`),{success:de,message:he}=N.data;de?Z("验证码发送成功，请检查邮箱！"):E(he),I(!1)},Ze=async()=>{if(i.email_verification_code===""){E("请输入邮箱验证码！");return}I(!0);const N=await v.get(`/api/oauth/email/bind?email=${i.email}&code=${i.email_verification_code}`),{success:de,message:he}=N.data;de?(Z("邮箱账户绑定成功！"),F(!1),u.user.email=i.email):E(he),I(!1)},Se=()=>u.user?u.user.username:"null",He=()=>{M(!1)},Cu=async N=>{await Re(N)?Z("已复制："+N):fe.error({title:"无法复制到剪贴板，请手动复制",content:N})};return e.jsx("div",{children:e.jsx(ae,{children:e.jsxs(ae.Content,{children:[e.jsxs(fe,{title:"请输入要划转的数量",visible:n,onOk:Ve,onCancel:He,maskClosable:!1,size:"small",centered:!0,children:[e.jsxs("div",{style:{marginTop:20},children:[e.jsx(Y.Text,{children:`可用额度${uu((iu=u==null?void 0:u.user)==null?void 0:iu.aff_quota)}`}),e.jsx(te,{style:{marginTop:5},value:(f=u==null?void 0:u.user)==null?void 0:f.aff_quota,disabled:!0})]}),e.jsxs("div",{style:{marginTop:20},children:[e.jsx(Y.Text,{children:`划转额度${uu(V)} 最低`+xe(du())}),e.jsx("div",{children:e.jsx(yu,{min:0,style:{marginTop:5},value:V,onChange:N=>C(N),disabled:!1})})]})]}),e.jsxs("div",{style:{marginTop:20},children:[e.jsxs(qe,{title:e.jsx(qe.Meta,{avatar:e.jsx(ku,{size:"default",color:tu(Se()),style:{marginRight:4},children:typeof Se()=="string"&&Se().slice(0,1)}),title:e.jsx(Y.Text,{children:Se()}),description:Xu()?e.jsx(D,{color:"red",children:"管理员"}):e.jsx(D,{color:"blue",children:"普通用户"})}),headerExtraContent:e.jsx(e.Fragment,{children:e.jsxs(ce,{vertical:!0,align:"start",children:[e.jsx(D,{color:"green",children:"ID: "+((S=u==null?void 0:u.user)==null?void 0:S.id)}),e.jsx(D,{color:"blue",children:(ee=u==null?void 0:u.user)==null?void 0:ee.group})]})}),footer:e.jsxs(Me,{row:!0,children:[e.jsx(Me.Item,{itemKey:"当前余额",children:xe((le=u==null?void 0:u.user)==null?void 0:le.quota)}),e.jsx(Me.Item,{itemKey:"历史消耗",children:xe((re=u==null?void 0:u.user)==null?void 0:re.used_quota)}),e.jsx(Me.Item,{itemKey:"请求次数",children:(Ee=u.user)==null?void 0:Ee.request_count})]}),children:[e.jsx(Y.Title,{heading:6,children:"可用模型"}),e.jsx("div",{style:{marginTop:10},children:e.jsx(ce,{wrap:!0,children:l.map(N=>e.jsx(D,{color:"cyan",onClick:()=>{Cu(N)},children:N},N))})})]}),e.jsxs(qe,{footer:e.jsxs("div",{children:[e.jsx(Y.Text,{children:"邀请链接"}),e.jsx(te,{style:{marginTop:10},value:R,onClick:O,readOnly:!0})]}),children:[e.jsx(Y.Title,{heading:6,children:"邀请信息"}),e.jsx("div",{style:{marginTop:10},children:e.jsxs(Me,{row:!0,children:[e.jsxs(Me.Item,{itemKey:"待使用收益",children:[e.jsx("span",{style:{color:"rgba(var(--semi-red-5), 1)"},children:xe((ve=u==null?void 0:u.user)==null?void 0:ve.aff_quota)}),e.jsx(w,{type:"secondary",onClick:()=>M(!0),size:"small",style:{marginLeft:10},children:"划转"})]}),e.jsx(Me.Item,{itemKey:"总收益",children:xe((Oe=u==null?void 0:u.user)==null?void 0:Oe.aff_history_quota)}),e.jsx(Me.Item,{itemKey:"邀请人数",children:(ru=u==null?void 0:u.user)==null?void 0:ru.aff_count})]})})]}),e.jsxs(qe,{children:[e.jsx(Y.Title,{heading:6,children:"个人信息"}),e.jsxs("div",{style:{marginTop:20},children:[e.jsx(Y.Text,{strong:!0,children:"邮箱"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("div",{children:e.jsx(te,{value:u.user&&u.user.email!==""?u.user.email:"未绑定",readonly:!0})}),e.jsx("div",{children:e.jsx(w,{onClick:()=>{F(!0)},children:u.user&&u.user.email!==""?"修改绑定":"绑定邮箱"})})]})]}),e.jsxs("div",{style:{marginTop:10},children:[e.jsx(Y.Text,{strong:!0,children:"微信"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("div",{children:e.jsx(te,{value:u.user&&u.user.wechat_id!==""?"已绑定":"未绑定",readonly:!0})}),e.jsx("div",{children:e.jsx(w,{disabled:u.user&&u.user.wechat_id!==""||!c.wechat_login,children:c.wechat_login?"绑定":"未启用"})})]})]}),e.jsxs("div",{style:{marginTop:10},children:[e.jsx(Y.Text,{strong:!0,children:"GitHub"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("div",{children:e.jsx(te,{value:u.user&&u.user.github_id!==""?u.user.github_id:"未绑定",readonly:!0})}),e.jsx("div",{children:e.jsx(w,{onClick:()=>{st(c.github_client_id)},disabled:u.user&&u.user.github_id!==""||!c.github_oauth,children:c.github_oauth?"绑定":"未启用"})})]})]}),e.jsxs("div",{style:{marginTop:10},children:[e.jsx(Y.Text,{strong:!0,children:"Telegram"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("div",{children:e.jsx(te,{value:u.user&&u.user.telegram_id!==""?u.user.telegram_id:"未绑定",readonly:!0})}),e.jsx("div",{children:c.telegram_oauth?u.user.telegram_id!==""?e.jsx(w,{disabled:!0,children:"已绑定"}):e.jsx(Vu,{dataAuthUrl:"/api/oauth/telegram/bind",botName:c.telegram_bot_name}):e.jsx(w,{disabled:!0,children:"未启用"})})]})]}),e.jsxs("div",{style:{marginTop:10},children:[e.jsxs(ce,{children:[e.jsx(w,{onClick:A,children:"生成系统访问令牌"}),e.jsx(w,{onClick:()=>{b(!0)},children:"修改密码"}),e.jsx(w,{type:"danger",onClick:()=>{o(!0)},children:"删除个人账户"})]}),z&&e.jsx(te,{readOnly:!0,value:z,onClick:se,style:{marginTop:"10px"}}),c.wechat_login&&e.jsx(w,{onClick:()=>{P(!0)},children:"绑定微信账号"}),e.jsxs(fe,{onCancel:()=>P(!1),visible:_,size:"small",children:[e.jsx(pt,{src:c.wechat_qrcode}),e.jsx("div",{style:{textAlign:"center"},children:e.jsx("p",{children:"微信扫码关注公众号，输入「验证码」获取验证码（三分钟内有效）"})}),e.jsx(te,{placeholder:"验证码",name:"wechat_verification_code",value:i.wechat_verification_code,onChange:N=>q("wechat_verification_code",N)}),e.jsx(w,{color:"",fluid:!0,size:"large",onClick:pe,children:"绑定"})]})]})]}),e.jsxs(fe,{onCancel:()=>F(!1),onOk:Ze,visible:x,size:"small",centered:!0,maskClosable:!1,children:[e.jsx(Y.Title,{heading:6,children:"绑定邮箱地址"}),e.jsxs("div",{style:{marginTop:20,display:"flex",justifyContent:"space-between"},children:[e.jsx(te,{fluid:!0,placeholder:"输入邮箱地址",onChange:N=>q("email",N),name:"email",type:"email"}),e.jsx(w,{onClick:Ye,disabled:Q||U,children:Q?`重新发送 (${y})`:"获取验证码"})]}),e.jsx("div",{style:{marginTop:10},children:e.jsx(te,{fluid:!0,placeholder:"验证码",name:"email_verification_code",value:i.email_verification_code,onChange:N=>q("email_verification_code",N)})}),k?e.jsx(Qe,{sitekey:m,onVerify:N=>{K(N)}}):e.jsx(e.Fragment,{})]}),e.jsxs(fe,{onCancel:()=>o(!1),visible:j,size:"small",centered:!0,onOk:me,children:[e.jsx("div",{style:{marginTop:20},children:e.jsx(au,{type:"danger",description:"您正在删除自己的帐户，将清空所有数据且不可恢复",closeIcon:null})}),e.jsxs("div",{style:{marginTop:20},children:[e.jsx(te,{placeholder:`输入你的账户名 ${(ou=u==null?void 0:u.user)==null?void 0:ou.username} 以确认删除`,name:"self_account_deletion_confirmation",value:i.self_account_deletion_confirmation,onChange:N=>q("self_account_deletion_confirmation",N)}),k?e.jsx(Qe,{sitekey:m,onVerify:N=>{K(N)}}):e.jsx(e.Fragment,{})]})]}),e.jsx(fe,{onCancel:()=>b(!1),visible:B,size:"small",centered:!0,onOk:Ce,children:e.jsxs("div",{style:{marginTop:20},children:[e.jsx(te,{name:"set_new_password",placeholder:"新密码",value:i.set_new_password,onChange:N=>q("set_new_password",N)}),e.jsx(te,{style:{marginTop:20},name:"set_new_password_confirmation",placeholder:"确认新密码",value:i.set_new_password_confirmation,onChange:N=>q("set_new_password_confirmation",N)}),k?e.jsx(Qe,{sitekey:m,onVerify:N=>{K(N)}}):e.jsx(e.Fragment,{})]})})]})]})})})},hs=()=>{let u=new Date,[t,a]=s.useState({QuotaForNewUser:0,QuotaForInviter:0,QuotaForInvitee:0,QuotaRemindThreshold:0,PreConsumedQuota:0,StreamCacheQueueLength:0,ModelRatio:"",ModelPrice:"",GroupRatio:"",TopUpLink:"",ChatLink:"",ChatLink2:"",QuotaPerUnit:0,AutomaticDisableChannelEnabled:"",AutomaticEnableChannelEnabled:"",ChannelDisableThreshold:0,LogConsumeEnabled:"",DisplayInCurrencyEnabled:"",DisplayTokenStatEnabled:"",CheckSensitiveEnabled:"",CheckSensitiveOnPromptEnabled:"",CheckSensitiveOnCompletionEnabled:"",StopOnSensitiveEnabled:"",SensitiveWords:"",MjNotifyEnabled:"",DrawingEnabled:"",DataExportEnabled:"",DataExportDefaultTime:"hour",DataExportInterval:5,DefaultCollapseSidebar:"",RetryTimes:0});const[i,d]=s.useState({});let[c,p]=s.useState(!1),[B,b]=s.useState(we(u.getTime()/1e3-30*24*3600));const _=[{key:"hour",text:"小时",value:"hour"},{key:"day",text:"天",value:"day"},{key:"week",text:"周",value:"week"}],P=async()=>{const k=await v.get("/api/option/"),{success:T,message:m,data:L}=k.data;if(T){let G={};L.forEach(K=>{(K.key==="ModelRatio"||K.key==="GroupRatio"||K.key==="ModelPrice")&&(K.value=JSON.stringify(JSON.parse(K.value),null,2)),G[K.key]=K.value}),a(G),d(G)}else E(m)};s.useEffect(()=>{P().then()},[]);const x=async(k,T)=>{p(!0),k.endsWith("Enabled")&&(T=t[k]==="true"?"false":"true"),k==="DefaultCollapseSidebar"&&(T=t[k]==="true"?"false":"true"),console.log(k,T);const m=await v.put("/api/option/",{key:k,value:T}),{success:L,message:G}=m.data;L?a(K=>({...K,[k]:T})):E(G),p(!1)},F=async(k,{name:T,value:m})=>{T.endsWith("Enabled")||T==="DataExportInterval"||T==="DataExportDefaultTime"||T==="DefaultCollapseSidebar"?(T==="DataExportDefaultTime"?localStorage.setItem("data_export_default_time",m):T==="MjNotifyEnabled"&&localStorage.setItem("mj_notify_enabled",m),await x(T,m)):a(L=>({...L,[T]:m}))},j=async k=>{switch(k){case"monitor":i.ChannelDisableThreshold!==t.ChannelDisableThreshold&&await x("ChannelDisableThreshold",t.ChannelDisableThreshold),i.QuotaRemindThreshold!==t.QuotaRemindThreshold&&await x("QuotaRemindThreshold",t.QuotaRemindThreshold);break;case"ratio":if(i.ModelRatio!==t.ModelRatio){if(!Xe(t.ModelRatio)){E("模型倍率不是合法的 JSON 字符串");return}await x("ModelRatio",t.ModelRatio)}if(i.GroupRatio!==t.GroupRatio){if(!Xe(t.GroupRatio)){E("分组倍率不是合法的 JSON 字符串");return}await x("GroupRatio",t.GroupRatio)}if(i.ModelPrice!==t.ModelPrice){if(!Xe(t.ModelPrice)){E("模型固定价格不是合法的 JSON 字符串");return}await x("ModelPrice",t.ModelPrice)}break;case"words":i.SensitiveWords!==t.SensitiveWords&&await x("SensitiveWords",t.SensitiveWords);break;case"quota":i.QuotaForNewUser!==t.QuotaForNewUser&&await x("QuotaForNewUser",t.QuotaForNewUser),i.QuotaForInvitee!==t.QuotaForInvitee&&await x("QuotaForInvitee",t.QuotaForInvitee),i.QuotaForInviter!==t.QuotaForInviter&&await x("QuotaForInviter",t.QuotaForInviter),i.PreConsumedQuota!==t.PreConsumedQuota&&await x("PreConsumedQuota",t.PreConsumedQuota);break;case"general":i.TopUpLink!==t.TopUpLink&&await x("TopUpLink",t.TopUpLink),i.ChatLink!==t.ChatLink&&await x("ChatLink",t.ChatLink),i.ChatLink2!==t.ChatLink2&&await x("ChatLink2",t.ChatLink2),i.QuotaPerUnit!==t.QuotaPerUnit&&await x("QuotaPerUnit",t.QuotaPerUnit),i.RetryTimes!==t.RetryTimes&&await x("RetryTimes",t.RetryTimes);break}},o=async()=>{console.log(t);const k=await v.delete(`/api/log/?target_timestamp=${Date.parse(B)/1e3}`),{success:T,message:m,data:L}=k.data;if(T){Z(`${L} 条日志已清理！`);return}E("日志清理失败："+m)};return e.jsx(ke,{columns:1,children:e.jsx(ke.Column,{children:e.jsxs(h,{loading:c,children:[e.jsx(oe,{as:"h3",children:"通用设置"}),e.jsxs(h.Group,{widths:4,children:[e.jsx(h.Input,{label:"充值链接",name:"TopUpLink",onChange:F,autoComplete:"new-password",value:t.TopUpLink,type:"link",placeholder:"例如发卡网站的购买链接"}),e.jsx(h.Input,{label:"默认聊天页面链接",name:"ChatLink",onChange:F,autoComplete:"new-password",value:t.ChatLink,type:"link",placeholder:"例如 ChatGPT Next Web 的部署地址"}),e.jsx(h.Input,{label:"聊天页面2链接",name:"ChatLink2",onChange:F,autoComplete:"new-password",value:t.ChatLink2,type:"link",placeholder:"例如 ChatGPT Web & Midjourney 的部署地址"}),e.jsx(h.Input,{label:"单位美元额度",name:"QuotaPerUnit",onChange:F,autoComplete:"new-password",value:t.QuotaPerUnit,type:"number",step:"0.01",placeholder:"一单位货币能兑换的额度"}),e.jsx(h.Input,{label:"失败重试次数",name:"RetryTimes",type:"number",step:"1",min:"0",onChange:F,autoComplete:"new-password",value:t.RetryTimes,placeholder:"失败重试次数"})]}),e.jsxs(h.Group,{inline:!0,children:[e.jsx(h.Checkbox,{checked:t.DisplayInCurrencyEnabled==="true",label:"以货币形式显示额度",name:"DisplayInCurrencyEnabled",onChange:F}),e.jsx(h.Checkbox,{checked:t.DisplayTokenStatEnabled==="true",label:"Billing 相关 API 显示令牌额度而非用户额度",name:"DisplayTokenStatEnabled",onChange:F}),e.jsx(h.Checkbox,{checked:t.DefaultCollapseSidebar==="true",label:"默认折叠侧边栏",name:"DefaultCollapseSidebar",onChange:F})]}),e.jsx(h.Button,{onClick:()=>{j("general").then()},children:"保存通用设置"}),e.jsx(ge,{}),e.jsx(oe,{as:"h3",children:"绘图设置"}),e.jsxs(h.Group,{inline:!0,children:[e.jsx(h.Checkbox,{checked:t.DrawingEnabled==="true",label:"启用绘图功能",name:"DrawingEnabled",onChange:F}),e.jsx(h.Checkbox,{checked:t.MjNotifyEnabled==="true",label:"允许回调（会泄露服务器ip地址）",name:"MjNotifyEnabled",onChange:F})]}),e.jsx(ge,{}),e.jsx(oe,{as:"h3",children:"屏蔽词过滤设置"}),e.jsx(h.Group,{inline:!0,children:e.jsx(h.Checkbox,{checked:t.CheckSensitiveEnabled==="true",label:"启用屏蔽词过滤功能",name:"CheckSensitiveEnabled",onChange:F})}),e.jsx(h.Group,{inline:!0,children:e.jsx(h.Checkbox,{checked:t.CheckSensitiveOnPromptEnabled==="true",label:"启用prompt检查",name:"CheckSensitiveOnPromptEnabled",onChange:F})}),e.jsx(h.Group,{widths:"equal",children:e.jsx(h.TextArea,{label:"屏蔽词列表，一行一个屏蔽词，不需要符号分割",name:"SensitiveWords",onChange:F,style:{minHeight:250,fontFamily:"JetBrains Mono, Consolas"},value:t.SensitiveWords,placeholder:"一行一个屏蔽词"})}),e.jsx(h.Button,{onClick:()=>{j("words").then()},children:"保存屏蔽词设置"}),e.jsx(ge,{}),e.jsx(oe,{as:"h3",children:"日志设置"}),e.jsx(h.Group,{inline:!0,children:e.jsx(h.Checkbox,{checked:t.LogConsumeEnabled==="true",label:"启用额度消费日志记录",name:"LogConsumeEnabled",onChange:F})}),e.jsx(h.Group,{widths:4,children:e.jsx(h.Input,{label:"目标时间",value:B,type:"datetime-local",name:"history_timestamp",onChange:(k,{name:T,value:m})=>{b(m)}})}),e.jsx(h.Button,{onClick:()=>{o().then()},children:"清理历史日志"}),e.jsx(ge,{}),e.jsx(oe,{as:"h3",children:"数据看板"}),e.jsx(h.Checkbox,{checked:t.DataExportEnabled==="true",label:"启用数据看板（实验性）",name:"DataExportEnabled",onChange:F}),e.jsxs(h.Group,{children:[e.jsx(h.Input,{label:"数据看板更新间隔（分钟，设置过短会影响数据库性能）",name:"DataExportInterval",type:"number",step:"1",min:"1",onChange:F,autoComplete:"new-password",value:t.DataExportInterval,placeholder:"数据看板更新间隔（分钟，设置过短会影响数据库性能）"}),e.jsx(h.Select,{label:"数据看板默认时间粒度（仅修改展示粒度，统计精确到小时）",options:_,name:"DataExportDefaultTime",onChange:F,autoComplete:"new-password",value:t.DataExportDefaultTime,placeholder:"数据看板默认时间粒度"})]}),e.jsx(ge,{}),e.jsx(oe,{as:"h3",children:"监控设置"}),e.jsxs(h.Group,{widths:3,children:[e.jsx(h.Input,{label:"最长响应时间",name:"ChannelDisableThreshold",onChange:F,autoComplete:"new-password",value:t.ChannelDisableThreshold,type:"number",min:"0",placeholder:"单位秒，当运行通道全部测试时，超过此时间将自动禁用通道"}),e.jsx(h.Input,{label:"额度提醒阈值",name:"QuotaRemindThreshold",onChange:F,autoComplete:"new-password",value:t.QuotaRemindThreshold,type:"number",min:"0",placeholder:"低于此额度时将发送邮件提醒用户"})]}),e.jsxs(h.Group,{inline:!0,children:[e.jsx(h.Checkbox,{checked:t.AutomaticDisableChannelEnabled==="true",label:"失败时自动禁用通道",name:"AutomaticDisableChannelEnabled",onChange:F}),e.jsx(h.Checkbox,{checked:t.AutomaticEnableChannelEnabled==="true",label:"成功时自动启用通道",name:"AutomaticEnableChannelEnabled",onChange:F})]}),e.jsx(h.Button,{onClick:()=>{j("monitor").then()},children:"保存监控设置"}),e.jsx(ge,{}),e.jsx(oe,{as:"h3",children:"额度设置"}),e.jsxs(h.Group,{widths:4,children:[e.jsx(h.Input,{label:"新用户初始额度",name:"QuotaForNewUser",onChange:F,autoComplete:"new-password",value:t.QuotaForNewUser,type:"number",min:"0",placeholder:"例如：100"}),e.jsx(h.Input,{label:"请求预扣费额度",name:"PreConsumedQuota",onChange:F,autoComplete:"new-password",value:t.PreConsumedQuota,type:"number",min:"0",placeholder:"请求结束后多退少补"}),e.jsx(h.Input,{label:"邀请新用户奖励额度",name:"QuotaForInviter",onChange:F,autoComplete:"new-password",value:t.QuotaForInviter,type:"number",min:"0",placeholder:"例如：2000"}),e.jsx(h.Input,{label:"新用户使用邀请码奖励额度",name:"QuotaForInvitee",onChange:F,autoComplete:"new-password",value:t.QuotaForInvitee,type:"number",min:"0",placeholder:"例如：1000"})]}),e.jsx(h.Button,{onClick:()=>{j("quota").then()},children:"保存额度设置"}),e.jsx(ge,{}),e.jsx(oe,{as:"h3",children:"倍率设置"}),e.jsx(h.Group,{widths:"equal",children:e.jsx(h.TextArea,{label:"模型固定价格（一次调用消耗多少刀，优先级大于模型倍率）",name:"ModelPrice",onChange:F,style:{minHeight:250,fontFamily:"JetBrains Mono, Consolas"},autoComplete:"new-password",value:t.ModelPrice,placeholder:'为一个 JSON 文本，键为模型名称，值为一次调用消耗多少刀，比如 "gpt-4-gizmo-*": 0.1，一次消耗0.1刀'})}),e.jsx(h.Group,{widths:"equal",children:e.jsx(h.TextArea,{label:"模型倍率",name:"ModelRatio",onChange:F,style:{minHeight:250,fontFamily:"JetBrains Mono, Consolas"},autoComplete:"new-password",value:t.ModelRatio,placeholder:"为一个 JSON 文本，键为模型名称，值为倍率"})}),e.jsx(h.Group,{widths:"equal",children:e.jsx(h.TextArea,{label:"分组倍率",name:"GroupRatio",onChange:F,style:{minHeight:250,fontFamily:"JetBrains Mono, Consolas"},autoComplete:"new-password",value:t.GroupRatio,placeholder:"为一个 JSON 文本，键为分组名称，值为倍率"})}),e.jsx(h.Button,{onClick:()=>{j("ratio").then()},children:"保存倍率设置"})]})})})},Fs=()=>{let u=[{tab:"个人设置",content:e.jsx(ds,{}),itemKey:"1"}];return Xu()&&(u.push({tab:"运营设置",content:e.jsx(hs,{}),itemKey:"2"}),u.push({tab:"系统设置",content:e.jsx(os,{}),itemKey:"3"}),u.push({tab:"其他设置",content:e.jsx(cs,{}),itemKey:"4"})),e.jsx("div",{children:e.jsx(ae,{children:e.jsx(ae.Content,{children:e.jsx(gt,{type:"line",defaultActiveKey:"1",children:u.map(t=>e.jsx(xt,{itemKey:t.itemKey,tab:t.tab,children:t.content},t.itemKey))})})})})},ms=()=>{const[u,t]=s.useState({email:""}),{email:a}=u,[i,d]=s.useState(!1),[c,p]=s.useState(!1),[B,b]=s.useState(""),[_,P]=s.useState(""),[x,F]=s.useState(!1),[j,o]=s.useState(30);s.useEffect(()=>{let m=null;return x&&j>0?m=setInterval(()=>{o(j-1)},1e3):j===0&&(F(!1),o(30)),()=>clearInterval(m)},[x,j]);function k(m){const{name:L,value:G}=m.target;t(K=>({...K,[L]:G}))}async function T(m){if(F(!0),!a)return;if(c&&_===""){je("请稍后几秒重试，Turnstile 正在检查用户环境！");return}d(!0);const L=await v.get(`/api/reset_password?email=${a}&turnstile=${_}`),{success:G,message:K}=L.data;G?(Z("重置邮件发送成功，请检查邮箱！"),t({...u,email:""})):E(K),d(!1)}return e.jsx(ke,{textAlign:"center",style:{marginTop:"48px"},children:e.jsxs(ke.Column,{style:{maxWidth:450},children:[e.jsxs(oe,{as:"h2",color:"",textAlign:"center",children:[e.jsx(_u,{src:"/logo.png"})," 密码重置"]}),e.jsx(h,{size:"large",children:e.jsxs(gu,{children:[e.jsx(h.Input,{fluid:!0,icon:"mail",iconPosition:"left",placeholder:"邮箱地址",name:"email",value:a,onChange:k}),c?e.jsx(Qe,{sitekey:B,onVerify:m=>{P(m)}}):e.jsx(e.Fragment,{}),e.jsx(Ne,{color:"green",fluid:!0,size:"large",onClick:T,loading:i,disabled:x,children:x?`重试 (${j})`:"提交"})]})})]})})},ps=()=>{const[u,t]=vu(),[a,i]=s.useContext(We),[d,c]=s.useState("处理中...");s.useState(!0);let p=_e();const B=async(b,_,P)=>{const x=await v.get(`/api/oauth/github?code=${b}&state=${_}`),{success:F,message:j,data:o}=x.data;if(F)j==="bind"?(Z("绑定成功！"),p("/setting")):(i({type:"login",payload:o}),localStorage.setItem("user",JSON.stringify(o)),Z("登录成功！"),p("/"));else{if(E(j),P===0){c("操作失败，重定向至登录界面中..."),p("/setting");return}P++,c(`出现错误，第 ${P} 次重试中...`),await new Promise(k=>setTimeout(k,P*2e3)),await B(b,_,P)}};return s.useEffect(()=>{let b=u.get("code"),_=u.get("state");B(b,_,0).then()},[]),e.jsx(gu,{style:{minHeight:"300px"},children:e.jsx(Mt,{active:!0,inverted:!0,children:e.jsx(Lt,{size:"large",children:d})})})},gs=()=>{const[u,t]=s.useState({email:"",token:""}),{email:a,token:i}=u,[d,c]=s.useState(!1),[p,B]=s.useState(!1),[b,_]=s.useState(30),[P,x]=s.useState(""),[F,j]=vu();s.useEffect(()=>{let k=F.get("token"),T=F.get("email");t({token:k,email:T})},[]),s.useEffect(()=>{let k=null;return p&&b>0?k=setInterval(()=>{_(b-1)},1e3):b===0&&(B(!1),_(30)),()=>clearInterval(k)},[p,b]);async function o(k){if(B(!0),!a)return;c(!0);const T=await v.post("/api/user/reset",{email:a,token:i}),{success:m,message:L}=T.data;if(m){let G=T.data.data;x(G),await Re(G),Lu(`新密码已复制到剪贴板：${G}`)}else E(L);c(!1)}return e.jsx(ke,{textAlign:"center",style:{marginTop:"48px"},children:e.jsxs(ke.Column,{style:{maxWidth:450},children:[e.jsxs(oe,{as:"h2",color:"",textAlign:"center",children:[e.jsx(_u,{src:"/logo.png"})," 密码重置确认"]}),e.jsx(h,{size:"large",children:e.jsxs(gu,{children:[e.jsx(h.Input,{fluid:!0,icon:"mail",iconPosition:"left",placeholder:"邮箱地址",name:"email",value:a,readOnly:!0}),P&&e.jsx(h.Input,{fluid:!0,icon:"lock",iconPosition:"left",placeholder:"新密码",name:"newPassword",value:P,readOnly:!0,onClick:k=>{k.target.select(),navigator.clipboard.writeText(P),Lu(`密码已复制到剪贴板：${P}`)}}),e.jsx(Ne,{color:"green",fluid:!0,size:"large",onClick:o,loading:d,disabled:p,children:p?"密码重置完成":"提交"})]})})]})})},$u={"gpt-3.5-turbo-0301":"gpt-3.5-turbo","gpt-4-0314":"gpt-4","gpt-4-32k-0314":"gpt-4-32k"};function xs(u){switch(u){case 15:return"按照如下格式输入：APIKey|SecretKey";case 18:return"按照如下格式输入：APPID|APISecret|APIKey";case 22:return"按照如下格式输入：APIKey-AppId，例如：fastgpt-0sp2gtvfdgyi4k30jwlgwf1i-64f335d84283f05518e9e041";case 23:return"按照如下格式输入：AppId|SecretId|SecretKey";default:return"请输入渠道对应的鉴权密钥"}}const Su=u=>{_e();const t=u.editingChannel.id,a=t!==void 0,[i,d]=s.useState(a),c=()=>{u.handleClose()},p={name:"",type:1,key:"",openai_organization:"",base_url:"",other:"",model_mapping:"",models:[],auto_ban:1,groups:["default"]},[B,b]=s.useState(!1),[_,P]=s.useState(!0),[x,F]=s.useState(p),[j,o]=s.useState([]),[k,T]=s.useState([]),[m,L]=s.useState([]),[G,K]=s.useState([]),[U,I]=s.useState([]),[Q,$]=s.useState(""),y=(l,r)=>{if(F(n=>({...n,[l]:r})),l==="type"&&x.models.length===0){let n=[];switch(r){case 14:n=["claude-instant-1.2","claude-2","claude-2.0","claude-2.1","claude-3-opus-20240229","claude-3-sonnet-20240229","claude-3-haiku-20240307"];break;case 11:n=["PaLM-2"];break;case 15:n=["ERNIE-Bot","ERNIE-Bot-turbo","ERNIE-Bot-4","Embedding-V1"];break;case 17:n=["qwen-turbo","qwen-plus","qwen-max","qwen-max-longcontext","text-embedding-v1"];break;case 16:n=["chatglm_pro","chatglm_std","chatglm_lite"];break;case 18:n=["SparkDesk","SparkDesk-v1.1","SparkDesk-v2.1","SparkDesk-v3.1","SparkDesk-v3.5"];break;case 19:n=["360GPT_S2_V9","embedding-bert-512-v1","embedding_s1_v1","semantic_similarity_s1_v1"];break;case 23:n=["hunyuan"];break;case 24:n=["gemini-pro","gemini-pro-vision"];break;case 25:n=["moonshot-v1-8k","moonshot-v1-32k","moonshot-v1-128k"];break;case 26:n=["glm-4","glm-4v","glm-3-turbo"];break;case 31:n=["yi-34b-chat-0205","yi-34b-chat-200k","yi-vl-plus"];break;case 2:n=["mj_imagine","mj_variation","mj_reroll","mj_blend","mj_upscale","mj_describe"];break;case 5:n=["swap_face","mj_imagine","mj_variation","mj_reroll","mj_blend","mj_upscale","mj_describe","mj_zoom","mj_shorten","mj_modal","mj_inpaint","mj_custom_zoom","mj_high_variation","mj_low_variation","mj_pan"];break}F(M=>({...M,models:n}))}},ue=async()=>{d(!0);let l=await v.get(`/api/channel/${t}`);if(l===void 0)return;const{success:r,message:n,data:M}=l.data;r?(M.models===""?M.models=[]:M.models=M.models.split(","),M.group===""?M.groups=[]:M.groups=M.group.split(","),M.model_mapping!==""&&(M.model_mapping=JSON.stringify(JSON.parse(M.model_mapping),null,2)),F(M),M.auto_ban===0?P(!1):P(!0)):E(n),d(!1)},R=async()=>{try{let l=await v.get("/api/channel/models");if(l===void 0)return;let r=l.data.data.map(n=>({label:n.id,value:n.id}));o(r),I(l.data.data.map(n=>n.id)),K(l.data.data.filter(n=>n.id.startsWith("gpt-3")||n.id.startsWith("text-")).map(n=>n.id))}catch(l){E(l.message)}},J=async()=>{try{let l=await v.get("/api/group/");if(l===void 0)return;L(l.data.data.map(r=>({label:r,value:r})))}catch(l){E(l.message)}};s.useEffect(()=>{let l=[...j];x.models.forEach(r=>{l.find(n=>n.key===r)||l.push({label:r,value:r})}),T(l)},[j,x.models]),s.useEffect(()=>{R().then(),J().then(),a?ue().then(()=>{}):F(p)},[u.editingChannel.id]);const z=async()=>{if(!a&&(x.name===""||x.key==="")){je("请填写渠道名称和渠道密钥！");return}if(x.models.length===0){je("请至少选择一个模型！");return}if(x.model_mapping!==""&&!Xe(x.model_mapping)){je("模型映射必须是合法的 JSON 格式！");return}let l={...x};l.base_url&&l.base_url.endsWith("/")&&(l.base_url=l.base_url.slice(0,l.base_url.length-1)),l.type===3&&l.other===""&&(l.other="2023-06-01-preview"),l.type===18&&l.other===""&&(l.other="v2.1");let r;if(!Array.isArray(l.models)){E("提交失败，请勿重复提交！"),c();return}l.auto_ban=_?1:0,l.models=l.models.join(","),l.group=l.groups.join(","),a?r=await v.put("/api/channel/",{...l,id:parseInt(t)}):r=await v.post("/api/channel/",l);const{success:n,message:M}=r.data;n?(a?Z("渠道更新成功！"):(Z("渠道创建成功！"),F(p)),u.refresh(),u.handleClose()):E(M)},H=()=>{if(Q.trim()==="")return;if(x.models.includes(Q))return E("该模型已存在！");let l=[...x.models];l.push(Q);let r=[];r.push({key:Q,text:Q,value:Q}),T(n=>[...n,...r]),$(""),y("models",l)};return e.jsx(e.Fragment,{children:e.jsx(nu,{maskClosable:!1,placement:a?"right":"left",title:e.jsx(Ue,{level:3,children:a?"更新渠道信息":"创建新的渠道"}),headerStyle:{borderBottom:"1px solid var(--semi-color-border)"},bodyStyle:{borderBottom:"1px solid var(--semi-color-border)"},visible:u.visible,footer:e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(ce,{children:[e.jsx(w,{theme:"solid",size:"large",onClick:z,children:"提交"}),e.jsx(w,{theme:"solid",size:"large",type:"tertiary",onClick:c,children:"取消"})]})}),closeIcon:null,onCancel:()=>c(),width:Be()?"100%":600,children:e.jsxs(Ge,{spinning:i,children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(Y.Text,{strong:!0,children:"类型："})}),e.jsx(De,{name:"type",required:!0,optionList:hu,value:x.type,onChange:l=>y("type",l),style:{width:"50%"}}),x.type===3&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(au,{type:"warning",description:e.jsxs(e.Fragment,{children:["注意，",e.jsx("strong",{children:"模型部署名称必须和模型名称保持一致"}),"，因为 One API 会把请求体中的 model 参数替换为你的部署名称（模型名称中的点会被剔除），",e.jsx("a",{target:"_blank",href:"https://github.com/songquanpeng/one-api/issues/133?notification_referrer_id=NT_kwDOAmJSYrM2NjIwMzI3NDgyOjM5OTk4MDUw#issuecomment-1571602271",children:"图片演示"}),"。"]})})}),e.jsx("div",{style:{marginTop:10},children:e.jsx(Y.Text,{strong:!0,children:"AZURE_OPENAI_ENDPOINT："})}),e.jsx(te,{label:"AZURE_OPENAI_ENDPOINT",name:"azure_base_url",placeholder:"请输入 AZURE_OPENAI_ENDPOINT，例如：https://docs-test-001.openai.azure.com",onChange:l=>{y("base_url",l)},value:x.base_url,autoComplete:"new-password"}),e.jsx("div",{style:{marginTop:10},children:e.jsx(Y.Text,{strong:!0,children:"默认 API 版本："})}),e.jsx(te,{label:"默认 API 版本",name:"azure_other",placeholder:"请输入默认 API 版本，例如：2023-06-01-preview，该配置可以被实际的请求查询参数所覆盖",onChange:l=>{y("other",l)},value:x.other,autoComplete:"new-password"})]}),x.type===8&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(Y.Text,{strong:!0,children:"Base URL："})}),e.jsx(te,{name:"base_url",placeholder:"请输入自定义渠道的 Base URL",onChange:l=>{y("base_url",l)},value:x.base_url,autoComplete:"new-password"})]}),e.jsx("div",{style:{marginTop:10},children:e.jsx(Y.Text,{strong:!0,children:"名称："})}),e.jsx(te,{required:!0,name:"name",placeholder:"请为渠道命名",onChange:l=>{y("name",l)},value:x.name,autoComplete:"new-password"}),e.jsx("div",{style:{marginTop:10},children:e.jsx(Y.Text,{strong:!0,children:"分组："})}),e.jsx(De,{placeholder:"请选择可以使用该渠道的分组",name:"groups",required:!0,multiple:!0,selection:!0,allowAdditions:!0,additionLabel:"请在系统设置页面编辑分组倍率以添加新的分组：",onChange:l=>{y("groups",l)},value:x.groups,autoComplete:"new-password",optionList:m}),x.type===18&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(Y.Text,{strong:!0,children:"模型版本："})}),e.jsx(te,{name:"other",placeholder:"请输入星火大模型版本，注意是接口地址中的版本号，例如：v2.1",onChange:l=>{y("other",l)},value:x.other,autoComplete:"new-password"})]}),x.type===21&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(Y.Text,{strong:!0,children:"知识库 ID："})}),e.jsx(te,{label:"知识库 ID",name:"other",placeholder:"请输入知识库 ID，例如：123456",onChange:l=>{y("other",l)},value:x.other,autoComplete:"new-password"})]}),e.jsx("div",{style:{marginTop:10},children:e.jsx(Y.Text,{strong:!0,children:"模型："})}),e.jsx(De,{placeholder:"请选择该渠道所支持的模型",name:"models",required:!0,multiple:!0,selection:!0,onChange:l=>{y("models",l)},value:x.models,autoComplete:"new-password",optionList:k}),e.jsxs("div",{style:{lineHeight:"40px",marginBottom:"12px"},children:[e.jsxs(ce,{children:[e.jsx(w,{type:"primary",onClick:()=>{y("models",G)},children:"填入基础模型"}),e.jsx(w,{type:"secondary",onClick:()=>{y("models",U)},children:"填入所有模型"}),e.jsx(w,{type:"warning",onClick:()=>{y("models",[])},children:"清除所有模型"})]}),e.jsx(te,{addonAfter:e.jsx(w,{type:"primary",onClick:H,children:"填入"}),placeholder:"输入自定义模型名称",value:Q,onChange:l=>{$(l.trim())}})]}),e.jsx("div",{style:{marginTop:10},children:e.jsx(Y.Text,{strong:!0,children:"模型重定向："})}),e.jsx(Pu,{placeholder:`此项可选，用于修改请求体中的模型名称，为一个 JSON 字符串，键为请求中模型名称，值为要替换的模型名称，例如：
${JSON.stringify($u,null,2)}`,name:"model_mapping",onChange:l=>{y("model_mapping",l)},autosize:!0,value:x.model_mapping,autoComplete:"new-password"}),e.jsx(Y.Text,{style:{color:"rgba(var(--semi-blue-5), 1)",userSelect:"none",cursor:"pointer"},onClick:()=>{y("model_mapping",JSON.stringify($u,null,2))},children:"填入模板"}),e.jsx("div",{style:{marginTop:10},children:e.jsx(Y.Text,{strong:!0,children:"密钥："})}),B?e.jsx(Pu,{label:"密钥",name:"key",required:!0,placeholder:"请输入密钥，一行一个",onChange:l=>{y("key",l)},value:x.key,style:{minHeight:150,fontFamily:"JetBrains Mono, Consolas"},autoComplete:"new-password"}):e.jsx(te,{label:"密钥",name:"key",required:!0,placeholder:xs(x.type),onChange:l=>{y("key",l)},value:x.key,autoComplete:"new-password"}),e.jsx("div",{style:{marginTop:10},children:e.jsx(Y.Text,{strong:!0,children:"组织："})}),e.jsx(te,{label:"组织，可选，不填则为默认组织",name:"openai_organization",placeholder:"请输入组织org-xxx",onChange:l=>{y("openai_organization",l)},value:x.openai_organization}),e.jsx("div",{style:{marginTop:10,display:"flex"},children:e.jsxs(ce,{children:[e.jsx(Bu,{name:"auto_ban",checked:_,onChange:()=>{P(!_)}}),e.jsx(Y.Text,{strong:!0,children:"是否自动禁用（仅当自动禁用开启时有效），关闭后不会自动禁用该渠道："})]})}),!a&&e.jsx("div",{style:{marginTop:10,display:"flex"},children:e.jsxs(ce,{children:[e.jsx(Bu,{checked:B,label:"批量创建",name:"batch",onChange:()=>b(!B)}),e.jsx(Y.Text,{strong:!0,children:"批量创建"})]})}),x.type!==3&&x.type!==8&&x.type!==22&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(Y.Text,{strong:!0,children:"代理："})}),e.jsx(te,{label:"代理",name:"base_url",placeholder:"此项可选，用于通过代理站来进行 API 调用",onChange:l=>{y("base_url",l)},value:x.base_url,autoComplete:"new-password"})]}),x.type===22&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(Y.Text,{strong:!0,children:"私有部署地址："})}),e.jsx(te,{name:"base_url",placeholder:"请输入私有部署地址，格式为：https://fastgpt.run/api/openapi",onChange:l=>{y("base_url",l)},value:x.base_url,autoComplete:"new-password"})]})]})})})};let Ke;function Es(u){var t,a;if(!Ke){Ke=new Map;for(let i=0;i<hu.length;i++)Ke[hu[i].value]=hu[i];Ke[0]={value:0,text:"未知类型",color:"grey"}}return e.jsx(D,{size:"large",color:(t=Ke[u])==null?void 0:t.color,children:(a=Ke[u])==null?void 0:a.text})}const Cs=()=>{const u=[{title:"ID",dataIndex:"id"},{title:"名称",dataIndex:"name"},{title:"分组",dataIndex:"group",render:(f,S,ee)=>e.jsx("div",{children:e.jsx(ce,{spacing:2,children:f.split(",").map((le,re)=>ut(le))})})},{title:"类型",dataIndex:"type",render:(f,S,ee)=>e.jsx("div",{children:Es(f)})},{title:"状态",dataIndex:"status",render:(f,S,ee)=>e.jsx("div",{children:A(f)})},{title:"响应时间",dataIndex:"response_time",render:(f,S,ee)=>e.jsx("div",{children:W(f)})},{title:"已用/剩余",dataIndex:"expired_time",render:(f,S,ee)=>e.jsx("div",{children:e.jsxs(ce,{spacing:1,children:[e.jsx(Le,{content:"已用额度",children:e.jsx(D,{color:"white",type:"ghost",size:"large",children:xe(S.used_quota)})}),e.jsx(Le,{content:"剩余额度"+S.balance+"，点击更新",children:e.jsxs(D,{color:"white",type:"ghost",size:"large",onClick:()=>{me(S)},children:["$",Yt(S.balance)]})})]})})},{title:"优先级",dataIndex:"priority",render:(f,S,ee)=>e.jsx("div",{children:e.jsx(yu,{style:{width:70},name:"priority",onBlur:le=>{q(S.id,"priority",S,le.target.value)},keepFocus:!0,innerButtons:!0,defaultValue:S.priority,min:-999})})},{title:"权重",dataIndex:"weight",render:(f,S,ee)=>e.jsx("div",{children:e.jsx(yu,{style:{width:70},name:"weight",onBlur:le=>{q(S.id,"weight",S,le.target.value)},keepFocus:!0,innerButtons:!0,defaultValue:S.weight,min:0})})},{title:"",dataIndex:"operate",render:(f,S,ee)=>e.jsxs("div",{children:[e.jsxs(Hu,{style:{marginRight:1},"aria-label":"测试操作项目组",children:[e.jsx(w,{theme:"light",onClick:()=>{g(S,"")},children:"测试"}),e.jsx(ze,{trigger:"click",position:"bottomRight",menu:S.test_models,children:e.jsx(w,{style:{padding:"8px 4px"},type:"primary",icon:e.jsx(Ku,{})})})]}),e.jsx(Ae,{title:"确定是否要删除此渠道？",content:"此修改将不可逆",okType:"danger",position:"left",onConfirm:()=>{q(S.id,"delete",S).then(()=>{n(S.id)})},children:e.jsx(w,{theme:"light",type:"danger",style:{marginRight:1},children:"删除"})}),S.status===1?e.jsx(w,{theme:"light",type:"warning",style:{marginRight:1},onClick:async()=>{q(S.id,"disable",S)},children:"禁用"}):e.jsx(w,{theme:"light",type:"secondary",style:{marginRight:1},onClick:async()=>{q(S.id,"enable",S)},children:"启用"}),e.jsx(w,{theme:"light",type:"tertiary",style:{marginRight:1},onClick:()=>{H(S),ue(!0)},children:"编辑"})]})}],[t,a]=s.useState([]),[i,d]=s.useState(!0),[c,p]=s.useState(1),[B,b]=s.useState(!1),[_,P]=s.useState(""),[x,F]=s.useState(""),[j,o]=s.useState(""),[k,T]=s.useState(!1),[m,L]=s.useState(!1),[G,K]=s.useState(ie);s.useState(Vt("channel-test"));const[U,I]=s.useState(G),[Q,$]=s.useState([]),[y,ue]=s.useState(!1),[R,J]=s.useState(!1),[z,H]=s.useState({id:void 0}),[l,r]=s.useState([]),n=f=>{let S=[...t];if(f!=null){let ee=S.findIndex(le=>le.id===f);ee>-1&&(S.splice(ee,1),a(S))}},M=f=>{for(let S=0;S<f.length;S++){f[S].key=""+f[S].id;let ee=[];f[S].models.split(",").forEach((le,re)=>{ee.push({node:"item",name:le,onClick:()=>{g(f[S],le)}})}),f[S].test_models=ee}a(f),f.length>=G?I(f.length+G):I(f.length)},V=async(f,S,ee)=>{d(!0);const le=await v.get(`/api/channel/?p=${f}&page_size=${S}&id_sort=${ee}`);if(le===void 0)return;const{success:re,message:Ee,data:ve}=le.data;if(re)if(f===0)M(ve);else{let Oe=[...t];Oe.splice(f*S,ve.length,...ve),M(Oe)}else E(Ee);d(!1)},C=async()=>{await V(c-1,G,B)};s.useEffect(()=>{const f=localStorage.getItem("id-sort")==="true",S=parseInt(localStorage.getItem("page-size"))||ie;b(f),K(S),V(0,S,f).then().catch(ee=>{E(ee)}),He().then()},[]);const q=async(f,S,ee,le)=>{let re={id:f},Ee;switch(S){case"delete":Ee=await v.delete(`/api/channel/${f}/`);break;case"enable":re.status=1,Ee=await v.put("/api/channel/",re);break;case"disable":re.status=2,Ee=await v.put("/api/channel/",re);break;case"priority":if(le==="")return;re.priority=parseInt(le),Ee=await v.put("/api/channel/",re);break;case"weight":if(le==="")return;re.weight=parseInt(le),re.weight<0&&(re.weight=0),Ee=await v.put("/api/channel/",re);break}const{success:ve,message:Oe}=Ee.data;if(ve){Z("操作成功完成！");let ru=Ee.data.data,ou=[...t];S==="delete"||(ee.status=ru.status),a(ou)}else E(Oe)},A=f=>{switch(f){case 1:return e.jsx(D,{size:"large",color:"green",children:"已启用"});case 2:return e.jsx(D,{size:"large",color:"yellow",children:"已禁用"});case 3:return e.jsx(D,{size:"large",color:"yellow",children:"自动禁用"});default:return e.jsx(D,{size:"large",color:"grey",children:"未知状态"})}},W=f=>{let S=f/1e3;return S=S.toFixed(2)+" 秒",f===0?e.jsx(D,{size:"large",color:"grey",children:"未测试"}):f<=1e3?e.jsx(D,{size:"large",color:"green",children:S}):f<=3e3?e.jsx(D,{size:"large",color:"lime",children:S}):f<=5e3?e.jsx(D,{size:"large",color:"yellow",children:S}):e.jsx(D,{size:"large",color:"red",children:S})},ne=async(f,S,ee)=>{if(f===""&&S===""&&ee===""){await V(0,G,B),p(1);return}T(!0);const le=await v.get(`/api/channel/search?keyword=${f}&group=${S}&model=${ee}`),{success:re,message:Ee,data:ve}=le.data;re?(a(ve),p(1)):E(Ee),T(!1)},g=async(f,S)=>{const ee=await v.get(`/api/channel/test/${f.id}?model=${S}`),{success:le,message:re,time:Ee}=ee.data;le?(f.response_time=Ee*1e3,f.test_time=Date.now()/1e3,je(`通道 ${f.name} 测试成功，耗时 ${Ee.toFixed(2)} 秒。`)):E(re)},O=async()=>{const f=await v.get("/api/channel/test"),{success:S,message:ee}=f.data;S?je("已成功开始测试所有通道，请刷新页面查看结果。"):E(ee)},se=async()=>{const f=await v.delete("/api/channel/disabled"),{success:S,message:ee,data:le}=f.data;S?(Z(`已删除所有禁用渠道，共计 ${le} 个`),await C()):E(ee)},me=async f=>{const S=await v.get(`/api/channel/update_balance/${f.id}/`),{success:ee,message:le,balance:re}=S.data;ee?(f.balance=re,f.balance_updated_time=Date.now()/1e3,je(`通道 ${f.name} 余额更新成功！`)):E(le)},pe=async()=>{L(!0);const f=await v.get("/api/channel/update_balance"),{success:S,message:ee}=f.data;S?je("已更新完毕所有已启用通道余额！"):E(ee),L(!1)},Ce=async()=>{if(l.length===0){E("请先选择要删除的通道！");return}d(!0);let f=[];l.forEach(Ee=>{f.push(Ee.id)});const S=await v.post("/api/channel/batch",{ids:f}),{success:ee,message:le,data:re}=S.data;ee?(Z(`已删除 ${re} 个通道！`),await C()):E(le),d(!1)},Ve=async()=>{const f=await v.post("/api/channel/fix"),{success:S,message:ee,data:le}=f.data;S?(Z(`已修复 ${le} 个通道！`),await C()):E(ee)};let Ye=t.slice((c-1)*G,c*G);const Ze=f=>{p(f),f===Math.ceil(t.length/G)+1&&V(f-1,G,B).then(S=>{})},Se=async f=>{localStorage.setItem("page-size",f+""),K(f),p(1),V(0,f,B).then().catch(S=>{E(S)})},He=async()=>{try{let f=await v.get("/api/group/");if(f===void 0)return;$(f.data.data.map(S=>({label:S,value:S})))}catch(f){E(f.message)}},Cu=()=>{ue(!1)},iu=(f,S)=>f.status!==1?{style:{background:"var(--semi-color-disabled-border)"}}:{};return e.jsxs(e.Fragment,{children:[e.jsx(Su,{refresh:C,visible:y,handleClose:Cu,editingChannel:z}),e.jsx(X,{onSubmit:()=>{ne(_,x,j)},labelPosition:"left",children:e.jsx("div",{style:{display:"flex"},children:e.jsxs(ce,{children:[e.jsx(X.Input,{field:"search_keyword",label:"搜索渠道关键词",placeholder:"ID，名称和密钥 ...",value:_,loading:k,onChange:f=>{P(f.trim())}}),e.jsx(X.Input,{field:"search_model",label:"模型",placeholder:"模型关键字",value:j,loading:k,onChange:f=>{o(f.trim())}}),e.jsx(X.Select,{field:"group",label:"分组",optionList:Q,onChange:f=>{F(f),ne(_,f,j)}}),e.jsx(w,{label:"查询",type:"primary",htmlType:"submit",className:"btn-margin-right",style:{marginRight:8},children:"查询"})]})})}),e.jsx("div",{style:{marginTop:10,display:"flex"},children:e.jsx(ce,{children:e.jsxs(ce,{children:[e.jsx(Y.Text,{strong:!0,children:"使用ID排序"}),e.jsx(Du,{checked:B,label:"使用ID排序",uncheckedText:"关","aria-label":"是否用ID排序",onChange:f=>{localStorage.setItem("id-sort",f+""),b(f),V(0,G,f).then().catch(S=>{E(S)})}})]})})}),e.jsx(Je,{className:"channel-table",style:{marginTop:15},columns:u,dataSource:Ye,pagination:{currentPage:c,pageSize:G,total:U,pageSizeOpts:[10,20,50,100],showSizeChanger:!0,formatPageText:f=>"",onPageSizeChange:f=>{Se(f).then()},onPageChange:Ze},loading:i,onRow:iu,rowSelection:R?{onChange:(f,S)=>{r(S)}}:null}),e.jsx("div",{style:{display:Be()?"":"flex",marginTop:Be()?0:-45,zIndex:999,position:"relative",pointerEvents:"none"},children:e.jsxs(ce,{style:{pointerEvents:"auto",marginTop:Be()?0:45},children:[e.jsx(w,{theme:"light",type:"primary",style:{marginRight:8},onClick:()=>{H({id:void 0}),ue(!0)},children:"添加渠道"}),e.jsx(Ae,{title:"确定？",okType:"warning",onConfirm:O,position:(Be(),"top"),children:e.jsx(w,{theme:"light",type:"warning",style:{marginRight:8},children:"测试所有通道"})}),e.jsx(Ae,{title:"确定？",okType:"secondary",onConfirm:pe,children:e.jsx(w,{theme:"light",type:"secondary",style:{marginRight:8},children:"更新所有已启用通道余额"})}),e.jsx(Ae,{title:"确定是否要删除禁用通道？",content:"此修改将不可逆",okType:"danger",onConfirm:se,children:e.jsx(w,{theme:"light",type:"danger",style:{marginRight:8},children:"删除禁用通道"})}),e.jsx(w,{theme:"light",type:"primary",style:{marginRight:8},onClick:C,children:"刷新"})]})}),e.jsx("div",{style:{marginTop:20},children:e.jsxs(ce,{children:[e.jsx(Y.Text,{strong:!0,children:"开启批量删除"}),e.jsx(Du,{label:"开启批量删除",uncheckedText:"关","aria-label":"是否开启批量删除",onChange:f=>{J(f)}}),e.jsx(Ae,{title:"确定是否要删除所选通道？",content:"此修改将不可逆",okType:"danger",onConfirm:Ce,disabled:!R,position:"top",children:e.jsx(w,{disabled:!R,theme:"light",type:"danger",style:{marginRight:8},children:"删除所选通道"})}),e.jsx(Ae,{title:"确定是否要修复数据库一致性？",content:"进行该操作时，可能导致渠道访问错误，请仅在数据库出现问题时使用",okType:"warning",onConfirm:Ve,position:"top",children:e.jsx(w,{theme:"light",type:"secondary",style:{marginRight:8},children:"修复数据库一致性"})})]})})]})},js=()=>e.jsx(e.Fragment,{children:e.jsxs(ae,{children:[e.jsx(ae.Header,{children:e.jsx("h3",{children:"管理渠道"})}),e.jsx(ae.Content,{children:e.jsx(Cs,{})})]})}),fs=u=>{const[t,a]=s.useState(!1),[i,d]=s.useState(t),c={name:"",remain_quota:t?0:5e5,expired_time:-1,unlimited_quota:!1,model_limits_enabled:!1,model_limits:[]},[p,B]=s.useState(c),{name:b,remain_quota:_,expired_time:P,unlimited_quota:x,model_limits_enabled:F,model_limits:j}=p,[o,k]=s.useState({});_e();const T=(R,J)=>{B(z=>({...z,[R]:J}))},m=()=>{u.handleClose()},L=(R,J,z,H)=>{let r=new Date().getTime()/1e3,n=R*30*24*60*60;n+=J*24*60*60,n+=z*60*60,n+=H*60,n!==0?(r+=n,B({...p,expired_time:we(r)})):B({...p,expired_time:-1})},G=()=>{B({...p,unlimited_quota:!x})},K=async()=>{let R=await v.get("/api/user/models");const{success:J,message:z,data:H}=R.data;if(J){let l=H.map(r=>({label:r,value:r}));k(l)}else E(z)},U=async()=>{d(!0);let R=await v.get(`/api/token/${u.editingToken.id}`);const{success:J,message:z,data:H}=R.data;J?(H.expired_time!==-1&&(H.expired_time=we(H.expired_time)),H.model_limits!==""?H.model_limits=H.model_limits.split(","):H.model_limits=[],B(H)):E(z),d(!1)};s.useEffect(()=>{a(u.editingToken.id!==void 0)},[u.editingToken.id]),s.useEffect(()=>{t?U().then(()=>{}):B(c),K()},[t]);const[I,Q]=s.useState(1),$=R=>{const J=parseInt(R,10);!isNaN(J)&&J>0&&Q(J)},y=()=>{const R="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let J="";for(let z=0;z<6;z++)J+=R.charAt(Math.floor(Math.random()*R.length));return J},ue=async()=>{if(d(!0),t){let R={...p};if(R.remain_quota=parseInt(R.remain_quota),R.expired_time!==-1){let l=Date.parse(R.expired_time);if(isNaN(l)){E("过期时间格式错误！"),d(!1);return}R.expired_time=Math.ceil(l/1e3)}R.model_limits=R.model_limits.join(",");let J=await v.put("/api/token/",{...R,id:parseInt(u.editingToken.id)});const{success:z,message:H}=J.data;z?(Z("令牌更新成功！"),u.refresh(),u.handleClose()):E(H)}else{let R=0;for(let J=0;J<I;J++){let z={...p};if(J!==0&&(z.name=`${p.name}-${y()}`),z.remain_quota=parseInt(z.remain_quota),z.expired_time!==-1){let n=Date.parse(z.expired_time);if(isNaN(n)){E("过期时间格式错误！"),d(!1);break}z.expired_time=Math.ceil(n/1e3)}z.model_limits=z.model_limits.join(",");let H=await v.post("/api/token/",z);const{success:l,message:r}=H.data;if(l)R++;else{E(r);break}}R>0&&(Z(`${R}个令牌创建成功，请在列表页面点击复制获取令牌！`),u.refresh(),u.handleClose())}d(!1),B(c),Q(1)};return e.jsx(e.Fragment,{children:e.jsx(nu,{placement:t?"right":"left",title:e.jsx(Ue,{level:3,children:t?"更新令牌信息":"创建新的令牌"}),headerStyle:{borderBottom:"1px solid var(--semi-color-border)"},bodyStyle:{borderBottom:"1px solid var(--semi-color-border)"},visible:u.visiable,footer:e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(ce,{children:[e.jsx(w,{theme:"solid",size:"large",onClick:ue,children:"提交"}),e.jsx(w,{theme:"solid",size:"large",type:"tertiary",onClick:m,children:"取消"})]})}),closeIcon:null,onCancel:()=>m(),width:Be()?"100%":600,children:e.jsxs(Ge,{spinning:i,children:[e.jsx(te,{style:{marginTop:20},label:"名称",name:"name",placeholder:"请输入名称",onChange:R=>T("name",R),value:b,autoComplete:"new-password",required:!t}),e.jsx(ge,{}),e.jsx(Et,{label:"过期时间",name:"expired_time",placeholder:"请选择过期时间",onChange:R=>T("expired_time",R),value:P,autoComplete:"new-password",type:"dateTime"}),e.jsx("div",{style:{marginTop:20},children:e.jsxs(ce,{children:[e.jsx(w,{type:"tertiary",onClick:()=>{L(0,0,0,0)},children:"永不过期"}),e.jsx(w,{type:"tertiary",onClick:()=>{L(0,0,1,0)},children:"一小时"}),e.jsx(w,{type:"tertiary",onClick:()=>{L(1,0,0,0)},children:"一个月"}),e.jsx(w,{type:"tertiary",onClick:()=>{L(0,1,0,0)},children:"一天"})]})}),e.jsx(ge,{}),e.jsx(au,{type:"warning",description:"注意，令牌的额度仅用于限制令牌本身的最大额度使用量，实际的使用受到账户的剩余额度限制。"}),e.jsx("div",{style:{marginTop:20},children:e.jsx(Y.Text,{children:`额度${uu(_)}`})}),e.jsx(Au,{style:{marginTop:8},name:"remain_quota",placeholder:"请输入额度",onChange:R=>T("remain_quota",R),value:_,autoComplete:"new-password",type:"number",data:[{value:5e5,label:"1$"},{value:5e6,label:"10$"},{value:25e6,label:"50$"},{value:5e7,label:"100$"},{value:25e7,label:"500$"},{value:5e8,label:"1000$"}],disabled:x}),!t&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:20},children:e.jsx(Y.Text,{children:"新建数量"})}),e.jsx(Au,{style:{marginTop:8},label:"数量",placeholder:"请选择或输入创建令牌的数量",onChange:R=>$(R),onSelect:R=>$(R),value:I.toString(),autoComplete:"off",type:"number",data:[{value:10,label:"10个"},{value:20,label:"20个"},{value:30,label:"30个"},{value:100,label:"100个"}],disabled:x})]}),e.jsx("div",{children:e.jsx(w,{style:{marginTop:8},type:"warning",onClick:()=>{G()},children:x?"取消无限额度":"设为无限额度"})}),e.jsx(ge,{}),e.jsx("div",{style:{marginTop:10,display:"flex"},children:e.jsxs(ce,{children:[e.jsx(Bu,{name:"model_limits_enabled",checked:F,onChange:R=>T("model_limits_enabled",R.target.checked)}),e.jsx(Y.Text,{children:"启用模型限制（非必要，不建议启用）"})]})}),e.jsx(De,{style:{marginTop:8},placeholder:"请选择该渠道所支持的模型",name:"models",required:!0,multiple:!0,selection:!0,onChange:R=>{T("model_limits",R)},value:p.model_limits,autoComplete:"new-password",optionList:o,disabled:!F})]})})})};function Nu(u){return e.jsx(e.Fragment,{children:we(u)})}function ys(u,t=!1){switch(u){case 1:return t?e.jsx(D,{color:"green",size:"large",children:"已启用：限制模型"}):e.jsx(D,{color:"green",size:"large",children:"已启用"});case 2:return e.jsxs(D,{color:"red",size:"large",children:[" ","已禁用"," "]});case 3:return e.jsxs(D,{color:"yellow",size:"large",children:[" ","已过期"," "]});case 4:return e.jsxs(D,{color:"grey",size:"large",children:[" ","已耗尽"," "]});default:return e.jsxs(D,{color:"black",size:"large",children:[" ","未知状态"," "]})}}const Bs=()=>{const u=[{title:"名称",dataIndex:"name"},{title:"状态",dataIndex:"status",key:"status",render:(A,W,ne)=>e.jsx("div",{children:ys(A,W.model_limits_enabled)})},{title:"已用额度",dataIndex:"used_quota",render:(A,W,ne)=>e.jsx("div",{children:xe(parseInt(A))})},{title:"剩余额度",dataIndex:"remain_quota",render:(A,W,ne)=>e.jsx("div",{children:W.unlimited_quota?e.jsx(D,{size:"large",color:"white",children:"无限制"}):e.jsx(D,{size:"large",color:"light-blue",children:xe(parseInt(A))})})},{title:"创建时间",dataIndex:"created_time",render:(A,W,ne)=>e.jsx("div",{children:Nu(A)})},{title:"过期时间",dataIndex:"expired_time",render:(A,W,ne)=>e.jsx("div",{children:W.expired_time===-1?"永不过期":Nu(A)})},{title:"",dataIndex:"operate",render:(A,W,ne)=>e.jsxs("div",{children:[e.jsx(qu,{content:"sk-"+W.key,style:{padding:20},position:"top",children:e.jsx(w,{theme:"light",type:"tertiary",style:{marginRight:1},children:"查看"})}),e.jsx(w,{theme:"light",type:"secondary",style:{marginRight:1},onClick:async g=>{await J("sk-"+W.key)},children:"复制"}),e.jsxs(Hu,{style:{marginRight:1},"aria-label":"项目操作按钮组",children:[e.jsx(w,{theme:"light",style:{color:"rgba(var(--semi-teal-7), 1)"},onClick:()=>{z("next",W.key)},children:"聊天"}),e.jsx(ze,{trigger:"click",position:"bottomRight",menu:[{node:"item",key:"next",disabled:!localStorage.getItem("chat_link"),name:"ChatGPT Next Web",onClick:()=>{z("next",W.key)}},{node:"item",key:"next-mj",disabled:!localStorage.getItem("chat_link2"),name:"ChatGPT Web & Midjourney",onClick:()=>{z("next-mj",W.key)}},{node:"item",key:"ama",name:"AMA 问天（BotGem）",onClick:()=>{z("ama",W.key)}},{node:"item",key:"opencat",name:"OpenCat",onClick:()=>{z("opencat",W.key)}}],children:e.jsx(w,{style:{padding:"8px 4px",color:"rgba(var(--semi-teal-7), 1)"},type:"primary",icon:e.jsx(Ku,{})})})]}),e.jsx(Ae,{title:"确定是否要删除此令牌？",content:"此修改将不可逆",okType:"danger",position:"left",onConfirm:()=>{l(W.id,"delete",W).then(()=>{H(W.key)})},children:e.jsx(w,{theme:"light",type:"danger",style:{marginRight:1},children:"删除"})}),W.status===1?e.jsx(w,{theme:"light",type:"warning",style:{marginRight:1},onClick:async()=>{l(W.id,"disable",W)},children:"禁用"}):e.jsx(w,{theme:"light",type:"secondary",style:{marginRight:1},onClick:async()=>{l(W.id,"enable",W)},children:"启用"}),e.jsx(w,{theme:"light",type:"tertiary",style:{marginRight:1},onClick:()=>{I(W),d(!0)},children:"编辑"})]})}],[t,a]=s.useState(ie),[i,d]=s.useState(!1),[c,p]=s.useState([]),[B,b]=s.useState([]),[_,P]=s.useState(t),[x,F]=s.useState(!0),[j,o]=s.useState(1),[k,T]=s.useState(""),[m,L]=s.useState(""),[G,K]=s.useState(!1);s.useState(!1),s.useState(0);const[U,I]=s.useState({id:void 0}),Q=()=>{d(!1),setTimeout(()=>{I({id:void 0})},500)},$=A=>{p(A),A.length>=t?P(A.length+t):P(A.length)};let y=c.slice((j-1)*t,j*t);const ue=async A=>{F(!0);const W=await v.get(`/api/token/?p=${A}&size=${t}`),{success:ne,message:g,data:O}=W.data;if(ne)if(A===0)$(O);else{let se=[...c];se.splice(A*t,O.length,...O),$(se)}else E(g);F(!1)},R=async()=>{await ue(j-1)},J=async A=>{await Re(A)?Z("已复制到剪贴板！"):fe.error({title:"无法复制到剪贴板，请手动复制",content:A,size:"large"})},z=async(A,W)=>{let ne=localStorage.getItem("status"),g="";ne&&(ne=JSON.parse(ne),g=ne.server_address),g===""&&(g=window.location.origin);let O=encodeURIComponent(g);const se=localStorage.getItem("chat_link"),me=localStorage.getItem("chat_link2");let pe;se&&(pe=se+`/#/?settings={"key":"sk-${W}","url":"${g}"}`);let Ce;switch(A){case"ama":Ce=`ama://set-api-key?server=${O}&key=sk-${W}`;break;case"opencat":Ce=`opencat://team/join?domain=${O}&token=sk-${W}`;break;case"next-mj":Ce=me+`/#/?settings={"key":"sk-${W}","url":"${g}"}`;break;default:if(!se){E("管理员未设置聊天链接");return}Ce=pe}window.open(Ce,"_blank")};s.useEffect(()=>{ue(0).then().catch(A=>{E(A)})},[t]);const H=A=>{let W=[...c];if(A!=null){let ne=W.findIndex(g=>g.key===A);ne>-1&&(W.splice(ne,1),$(W))}},l=async(A,W,ne)=>{F(!0);let g={id:A},O;switch(W){case"delete":O=await v.delete(`/api/token/${A}/`);break;case"enable":g.status=1,O=await v.put("/api/token/?status_only=true",g);break;case"disable":g.status=2,O=await v.put("/api/token/?status_only=true",g);break}const{success:se,message:me}=O.data;if(se){Z("操作成功完成！");let pe=O.data.data,Ce=[...c];W==="delete"||(ne.status=pe.status),$(Ce)}else E(me);F(!1)},r=async()=>{if(k===""&&m===""){await ue(0),o(1);return}K(!0);const A=await v.get(`/api/token/search?keyword=${k}&token=${m}`),{success:W,message:ne,data:g}=A.data;W?($(g),o(1)):E(ne),K(!1)},n=async A=>{T(A.trim())},M=async A=>{L(A.trim())},V=A=>{o(A),A===Math.ceil(c.length/t)+1&&ue(A-1).then(W=>{})},C={onSelect:(A,W)=>{},onSelectAll:(A,W)=>{},onChange:(A,W)=>{b(W)}},q=(A,W)=>A.status!==1?{style:{background:"var(--semi-color-disabled-border)"}}:{};return e.jsxs(e.Fragment,{children:[e.jsx(fs,{refresh:R,editingToken:U,visiable:i,handleClose:Q}),e.jsxs(X,{layout:"horizontal",style:{marginTop:10},labelPosition:"left",children:[e.jsx(X.Input,{field:"keyword",label:"搜索关键字",placeholder:"令牌名称",value:k,loading:G,onChange:n}),e.jsx(X.Input,{field:"token",label:"Key",placeholder:"密钥",value:m,loading:G,onChange:M}),e.jsx(w,{label:"查询",type:"primary",htmlType:"submit",className:"btn-margin-right",onClick:r,style:{marginRight:8},children:"查询"})]}),e.jsx(Je,{style:{marginTop:20},columns:u,dataSource:y,pagination:{currentPage:j,pageSize:t,total:_,showSizeChanger:!0,pageSizeOptions:[10,20,50,100],formatPageText:A=>`第 ${A.currentStart} - ${A.currentEnd} 条，共 ${c.length} 条`,onPageSizeChange:A=>{a(A),o(1)},onPageChange:V},loading:x,rowSelection:C,onRow:q}),e.jsx(w,{theme:"light",type:"primary",style:{marginRight:8},onClick:()=>{I({id:void 0}),d(!0)},children:"添加令牌"}),e.jsx(w,{label:"复制所选令牌",type:"warning",onClick:async()=>{if(B.length===0){E("请至少选择一个令牌！");return}let A="";for(let W=0;W<B.length;W++)A+=B[W].name+"    sk-"+B[W].key+`
`;await J(A)},children:"复制所选令牌到剪贴板"})]})},Ds=()=>e.jsx(e.Fragment,{children:e.jsxs(ae,{children:[e.jsx(ae.Header,{children:e.jsx("h3",{children:"我的令牌"})}),e.jsx(ae.Content,{children:e.jsx(Bs,{})})]})}),As=u=>{const t=u.editingRedemption.id!==void 0,[a,i]=s.useState(t);ot(),_e();const d={name:"",quota:1e5,count:1},[c,p]=s.useState(d),{name:B,quota:b,count:_}=c,P=()=>{u.handleClose()},x=(o,k)=>{p(T=>({...T,[o]:k}))},F=async()=>{i(!0);let o=await v.get(`/api/redemption/${u.editingRedemption.id}`);const{success:k,message:T,data:m}=o.data;k?p(m):E(T),i(!1)};s.useEffect(()=>{t?F().then(()=>{}):p(d)},[u.editingRedemption.id]);const j=async()=>{if(!t&&c.name==="")return;i(!0);let o=c;o.count=parseInt(o.count),o.quota=parseInt(o.quota);let k;t?k=await v.put("/api/redemption/",{...o,id:parseInt(u.editingRedemption.id)}):k=await v.post("/api/redemption/",{...o});const{success:T,message:m,data:L}=k.data;if(T?t?(Z("兑换码更新成功！"),u.refresh(),u.handleClose()):(Z("兑换码创建成功！"),p(d),u.refresh(),u.handleClose()):E(m),!t&&L){let G="";for(let K=0;K<L.length;K++)G+=L[K]+`
`;fe.confirm({title:"兑换码创建成功",content:e.jsxs("div",{children:[e.jsx("p",{children:"兑换码创建成功，是否下载兑换码？"}),e.jsx("p",{children:"兑换码将以文本文件的形式下载，文件名为兑换码的名称。"})]}),onOk:()=>{Jt(G,`${c.name}.txt`)}})}i(!1)};return e.jsx(e.Fragment,{children:e.jsx(nu,{placement:t?"right":"left",title:e.jsx(Ue,{level:3,children:t?"更新兑换码信息":"创建新的兑换码"}),headerStyle:{borderBottom:"1px solid var(--semi-color-border)"},bodyStyle:{borderBottom:"1px solid var(--semi-color-border)"},visible:u.visiable,footer:e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(ce,{children:[e.jsx(w,{theme:"solid",size:"large",onClick:j,children:"提交"}),e.jsx(w,{theme:"solid",size:"large",type:"tertiary",onClick:P,children:"取消"})]})}),closeIcon:null,onCancel:()=>P(),width:Be()?"100%":600,children:e.jsxs(Ge,{spinning:a,children:[e.jsx(te,{style:{marginTop:20},label:"名称",name:"name",placeholder:"请输入名称",onChange:o=>x("name",o),value:B,autoComplete:"new-password",required:!t}),e.jsx(ge,{}),e.jsx("div",{style:{marginTop:20},children:e.jsx(Y.Text,{children:`额度${uu(b)}`})}),e.jsx(Au,{style:{marginTop:8},name:"quota",placeholder:"请输入额度",onChange:o=>x("quota",o),value:b,autoComplete:"new-password",type:"number",position:"bottom",data:[{value:5e5,label:"1$"},{value:5e6,label:"10$"},{value:25e6,label:"50$"},{value:5e7,label:"100$"},{value:25e7,label:"500$"},{value:5e8,label:"1000$"}]}),!t&&e.jsxs(e.Fragment,{children:[e.jsx(ge,{}),e.jsx(Y.Text,{children:"生成数量"}),e.jsx(te,{style:{marginTop:8},label:"生成数量",name:"count",placeholder:"请输入生成数量",onChange:o=>x("count",o),value:_,autoComplete:"new-password",type:"number"})]})]})})})};function bs(u){return e.jsx(e.Fragment,{children:we(u)})}function ws(u){switch(u){case 1:return e.jsx(D,{color:"green",size:"large",children:"未使用"});case 2:return e.jsxs(D,{color:"red",size:"large",children:[" ","已禁用"," "]});case 3:return e.jsxs(D,{color:"grey",size:"large",children:[" ","已使用"," "]});default:return e.jsxs(D,{color:"black",size:"large",children:[" ","未知状态"," "]})}}const Ss=()=>{const u=[{title:"ID",dataIndex:"id"},{title:"名称",dataIndex:"name"},{title:"状态",dataIndex:"status",key:"status",render:(r,n,M)=>e.jsx("div",{children:ws(r)})},{title:"额度",dataIndex:"quota",render:(r,n,M)=>e.jsx("div",{children:xe(parseInt(r))})},{title:"创建时间",dataIndex:"created_time",render:(r,n,M)=>e.jsx("div",{children:bs(r)})},{title:"兑换人ID",dataIndex:"used_user_id",render:(r,n,M)=>e.jsx("div",{children:r===0?"无":r})},{title:"",dataIndex:"operate",render:(r,n,M)=>e.jsxs("div",{children:[e.jsx(qu,{content:n.key,style:{padding:20},position:"top",children:e.jsx(w,{theme:"light",type:"tertiary",style:{marginRight:1},children:"查看"})}),e.jsx(w,{theme:"light",type:"secondary",style:{marginRight:1},onClick:async V=>{await Q(n.key)},children:"复制"}),e.jsx(Ae,{title:"确定是否要删除此兑换码？",content:"此修改将不可逆",okType:"danger",position:"left",onConfirm:()=>{y(n.id,"delete",n).then(()=>{I(n.key)})},children:e.jsx(w,{theme:"light",type:"danger",style:{marginRight:1},children:"删除"})}),n.status===1?e.jsx(w,{theme:"light",type:"warning",style:{marginRight:1},onClick:async()=>{y(n.id,"disable",n)},children:"禁用"}):e.jsx(w,{theme:"light",type:"secondary",style:{marginRight:1},onClick:async()=>{y(n.id,"enable",n)},disabled:n.status===3,children:"启用"}),e.jsx(w,{theme:"light",type:"tertiary",style:{marginRight:1},onClick:()=>{T(n),L(!0)},disabled:n.status!==1,children:"编辑"})]})}],[t,a]=s.useState([]),[i,d]=s.useState(!0),[c,p]=s.useState(1),[B,b]=s.useState(""),[_,P]=s.useState(!1),[x,F]=s.useState(ie),[j,o]=s.useState([]),[k,T]=s.useState({id:void 0}),[m,L]=s.useState(!1),G=()=>{L(!1)},K=r=>{a(r),r.length>=c*ie?F(r.length+1):F(r.length)},U=async r=>{const n=await v.get(`/api/redemption/?p=${r}`),{success:M,message:V,data:C}=n.data;if(M)if(r===0)K(C);else{let q=t;q.push(...C),K(q)}else E(V);d(!1)},I=r=>{let n=[...t];if(r!=null){let M=n.findIndex(V=>V.key===r);M>-1&&(n.splice(M,1),a(n))}},Q=async r=>{await Re(r)?Z("已复制到剪贴板！"):fe.error({title:"无法复制到剪贴板，请手动复制",content:r})};s.useEffect(()=>{U(0).then().catch(r=>{E(r)})},[]);const $=async()=>{await U(c-1)},y=async(r,n,M)=>{let V={id:r},C;switch(n){case"delete":C=await v.delete(`/api/redemption/${r}/`);break;case"enable":V.status=1,C=await v.put("/api/redemption/?status_only=true",V);break;case"disable":V.status=2,C=await v.put("/api/redemption/?status_only=true",V);break}const{success:q,message:A}=C.data;if(q){Z("操作成功完成！");let W=C.data.data,ne=[...t];n==="delete"||(M.status=W.status),a(ne)}else E(A)},ue=async()=>{if(B===""){await U(0),p(1);return}P(!0);const r=await v.get(`/api/redemption/search?keyword=${B}`),{success:n,message:M,data:V}=r.data;n?(a(V),p(1)):E(M),P(!1)},R=async r=>{b(r.trim())},J=r=>{p(r),r===Math.ceil(t.length/ie)+1&&U(r-1).then(n=>{})};let z=t.slice((c-1)*ie,c*ie);const H={onSelect:(r,n)=>{},onSelectAll:(r,n)=>{},onChange:(r,n)=>{o(n)}},l=(r,n)=>r.status!==1?{style:{background:"var(--semi-color-disabled-border)"}}:{};return e.jsxs(e.Fragment,{children:[e.jsx(As,{refresh:$,editingRedemption:k,visiable:m,handleClose:G}),e.jsx(X,{onSubmit:ue,children:e.jsx(X.Input,{label:"搜索关键字",field:"keyword",icon:"search",iconPosition:"left",placeholder:"关键字(id或者名称)",value:B,loading:_,onChange:R})}),e.jsx(Je,{style:{marginTop:20},columns:u,dataSource:z,pagination:{currentPage:c,pageSize:ie,total:x,formatPageText:r=>`第 ${r.currentStart} - ${r.currentEnd} 条，共 ${t.length} 条`,onPageChange:J},loading:i,rowSelection:H,onRow:l}),e.jsx(w,{theme:"light",type:"primary",style:{marginRight:8},onClick:()=>{T({id:void 0}),L(!0)},children:"添加兑换码"}),e.jsx(w,{label:"复制所选兑换码",type:"warning",onClick:async()=>{if(j.length===0){E("请至少选择一个兑换码！");return}let r="";for(let n=0;n<j.length;n++)r+=j[n].name+"    "+j[n].key+`
`;await Q(r)},children:"复制所选兑换码到剪贴板"})]})},vs=()=>e.jsx(e.Fragment,{children:e.jsxs(ae,{children:[e.jsx(ae.Header,{children:e.jsx("h3",{children:"管理兑换码"})}),e.jsx(ae.Content,{children:e.jsx(Ss,{})})]})}),ks=()=>{const[u,t]=s.useState(""),[a,i]=s.useState(""),[d,c]=s.useState(10);s.useState(1);const[p,B]=s.useState(0),[b,_]=s.useState(1),[P,x]=s.useState(""),[F,j]=s.useState(!1),[o,k]=s.useState(0),[T,m]=s.useState(!1),[L,G]=s.useState(!0),[K,U]=s.useState(!1),[I,Q]=s.useState(""),$=async()=>{if(u===""){je("请输入兑换码！");return}m(!0);try{const n=await v.post("/api/user/topup",{key:u}),{success:M,message:V,data:C}=n.data;M?(Z("兑换成功！"),fe.success({title:"兑换成功！",content:"成功兑换额度："+xe(C),centered:!0}),k(q=>q+C),t("")):E(V)}catch{E("请求失败")}finally{m(!1)}},y=async()=>{await v.post("/api/user/check_in",{})},ue=()=>{if(!P){E("超级管理员未设置充值链接！");return}window.open(P,"_blank")},R=async n=>{if(!F){E("管理员未开启在线充值！");return}if(p===0&&await l(),d<b){je("充值数量不能小于"+b);return}Q(n),U(!0)},J=async()=>{if(p===0&&await l(),d<b){je("充值数量不能小于"+b);return}U(!1);try{const n=await v.post("/api/user/pay",{amount:parseInt(d),top_up_code:a,payment_method:I});if(n!==void 0){const{message:M,data:V}=n.data;if(M==="success"){let C=V,q=n.data.url,A=document.createElement("form");A.action=q,A.method="POST",navigator.userAgent.indexOf("Safari")>-1&&navigator.userAgent.indexOf("Chrome")<1||(A.target="_blank");for(let ne in C){let g=document.createElement("input");g.type="hidden",g.name=ne,g.value=C[ne],A.appendChild(g)}document.body.appendChild(A),A.submit(),document.body.removeChild(A)}else E(V)}else E(n)}catch(n){console.log(n)}finally{}},z=async()=>{let n=await v.get("/api/user/self");const{success:M,message:V,data:C}=n.data;M?k(C.quota):E(V)};s.useEffect(()=>{let n=localStorage.getItem("status");n&&(n=JSON.parse(n),n.top_up_link&&x(n.top_up_link),n.min_topup&&_(n.min_topup),n.enable_online_topup&&j(n.enable_online_topup)),z().then()},[]);const H=()=>p+"元",l=async n=>{n===void 0&&(n=d);try{const M=await v.post("/api/user/amount",{amount:parseFloat(n),top_up_code:a});if(M!==void 0){const{message:V,data:C}=M.data;V==="success"?B(parseFloat(C)):E(C)}else E(M)}catch(M){console.log(M)}finally{}},r=()=>{U(!1)};return e.jsx("div",{children:e.jsxs(ae,{children:[e.jsx(ae.Header,{children:e.jsx("h3",{children:"我的钱包"})}),e.jsxs(ae.Content,{children:[e.jsxs(fe,{title:"确定要充值吗",visible:K,onOk:J,onCancel:r,maskClosable:!1,size:"small",centered:!0,children:[e.jsxs("p",{children:["充值数量：",d,"$"]}),e.jsxs("p",{children:["实付金额：",H()]}),e.jsx("p",{children:"是否确认充值？"})]}),e.jsx("div",{style:{marginTop:20,display:"flex",justifyContent:"center"},children:e.jsxs(qe,{style:{width:"500px",padding:"20px"},children:[e.jsxs(Ue,{level:3,style:{textAlign:"center"},children:["余额 ",xe(o)]}),e.jsxs("div",{style:{marginTop:20},children:[e.jsx(Fu,{children:"兑换余额"}),e.jsxs(X,{children:[e.jsx(X.Input,{field:"redemptionCode",label:"兑换码",placeholder:"兑换码",name:"redemptionCode",value:u,onChange:n=>{t(n)}}),e.jsxs(ce,{children:[P?e.jsx(w,{type:"primary",theme:"solid",onClick:ue,children:"获取兑换码"}):null,e.jsx(w,{type:"warning",theme:"solid",onClick:$,disabled:T,children:T?"兑换中...":"兑换"}),e.jsx(w,{type:"warning",theme:"solid",onClick:y,disabled:L,children:L?"签到(（开发中)":"签到"})]})]})]}),e.jsxs("div",{style:{marginTop:20},children:[e.jsx(Fu,{children:"在线充值"}),e.jsxs(X,{children:[e.jsx(X.Input,{disabled:!F,field:"redemptionCount",label:"实付金额："+H(),placeholder:"充值数量，最低"+b+"$",name:"redemptionCount",type:"number",value:d,suffix:"$",min:b,defaultValue:b,max:1e5,onChange:async n=>{n<1&&(n=1),n>1e5&&(n=1e5),c(n),await l(n)}}),e.jsxs(ce,{children:[e.jsx(w,{type:"primary",theme:"solid",onClick:async()=>{R("zfb")},children:"支付宝"}),e.jsx(w,{style:{backgroundColor:"rgba(var(--semi-green-5), 1)"},type:"primary",theme:"solid",onClick:async()=>{R("wx")},children:"微信"})]})]})]})]})})]})]})})},{Header:_s}=ae,Gu=["amber","blue","cyan","green","grey","indigo","light-blue","lime","orange","pink","purple","red","teal","violet","yellow"];function Ts(u){switch(u){case 1:return e.jsxs(D,{color:"cyan",size:"large",children:[" ","充值"," "]});case 2:return e.jsxs(D,{color:"lime",size:"large",children:[" ","消费"," "]});case 3:return e.jsxs(D,{color:"orange",size:"large",children:[" ","管理"," "]});case 4:return e.jsxs(D,{color:"purple",size:"large",children:[" ","系统"," "]});default:return e.jsxs(D,{color:"black",size:"large",children:[" ","未知"," "]})}}function Is(u){return u?e.jsx(D,{color:"blue",size:"large",children:"流"}):e.jsx(D,{color:"purple",size:"large",children:"非流"})}function Ps(u){const t=parseInt(u);return t<101?e.jsxs(D,{color:"green",size:"large",children:[" ",t," s"," "]}):t<300?e.jsxs(D,{color:"orange",size:"large",children:[" ",t," s"," "]}):e.jsxs(D,{color:"red",size:"large",children:[" ",t," s"," "]})}const Rs=()=>{const u=[{title:"时间",dataIndex:"timestamp2string"},{title:"渠道",dataIndex:"channel",className:be()?"tableShow":"tableHiddle",render:(g,O,se)=>m?O.type===0||O.type===2?e.jsx("div",{children:e.jsxs(D,{color:Gu[parseInt(g)%Gu.length],size:"large",children:[" ",g," "]})}):e.jsx(e.Fragment,{}):e.jsx(e.Fragment,{})},{title:"用户",dataIndex:"username",className:be()?"tableShow":"tableHiddle",render:(g,O,se)=>m?e.jsxs("div",{children:[e.jsx(ku,{size:"small",color:tu(g),style:{marginRight:4},onClick:()=>n(O.user_id),children:typeof g=="string"&&g.slice(0,1)}),g]}):e.jsx(e.Fragment,{})},{title:"令牌",dataIndex:"token_name",render:(g,O,se)=>O.type===0||O.type===2?e.jsx("div",{children:e.jsxs(D,{color:"grey",size:"large",onClick:()=>{ne(g)},children:[" ",g," "]})}):e.jsx(e.Fragment,{})},{title:"类型",dataIndex:"type",render:(g,O,se)=>e.jsx("div",{children:Ts(g)})},{title:"模型",dataIndex:"model_name",render:(g,O,se)=>O.type===0||O.type===2?e.jsx("div",{children:e.jsxs(D,{color:tu(g),size:"large",onClick:()=>{ne(g)},children:[" ",g," "]})}):e.jsx(e.Fragment,{})},{title:"用时",dataIndex:"use_time",render:(g,O,se)=>e.jsx("div",{children:e.jsxs(ce,{children:[Ps(g),Is(O.is_stream)]})})},{title:"提示",dataIndex:"prompt_tokens",render:(g,O,se)=>O.type===0||O.type===2?e.jsx("div",{children:e.jsxs("span",{children:[" ",g," "]})}):e.jsx(e.Fragment,{})},{title:"补全",dataIndex:"completion_tokens",render:(g,O,se)=>parseInt(g)>0&&(O.type===0||O.type===2)?e.jsx("div",{children:e.jsxs("span",{children:[" ",g," "]})}):e.jsx(e.Fragment,{})},{title:"花费",dataIndex:"quota",render:(g,O,se)=>O.type===0||O.type===2?e.jsx("div",{children:xe(g,6)}):e.jsx(e.Fragment,{})},{title:"详情",dataIndex:"content",render:(g,O,se)=>e.jsx(Ct,{ellipsis:{rows:2,showTooltip:{type:"popover",opts:{style:{width:240}}}},style:{maxWidth:240},children:g})}],[t,a]=s.useState([]),[i,d]=s.useState(!1),[c,p]=s.useState(!1),[B,b]=s.useState(!1),[_,P]=s.useState(1),[x,F]=s.useState(ie),[j,o]=s.useState(ie);s.useState(""),s.useState(!1);const[k,T]=s.useState(0),m=be();let L=new Date;const[G,K]=s.useState({username:"",token_name:"",model_name:"",start_timestamp:we(L.getTime()/1e3-86400),end_timestamp:we(L.getTime()/1e3+3600),channel:""}),{username:U,token_name:I,model_name:Q,start_timestamp:$,end_timestamp:y,channel:ue}=G,[R,J]=s.useState({quota:0,token:0}),z=(g,O)=>{K(se=>({...se,[O]:g}))},H=async()=>{let g=Date.parse($)/1e3,O=Date.parse(y)/1e3,se=await v.get(`/api/log/self/stat?type=${k}&token_name=${I}&model_name=${Q}&start_timestamp=${g}&end_timestamp=${O}`);const{success:me,message:pe,data:Ce}=se.data;me?J(Ce):E(pe)},l=async()=>{let g=Date.parse($)/1e3,O=Date.parse(y)/1e3,se=await v.get(`/api/log/stat?type=${k}&username=${U}&token_name=${I}&model_name=${Q}&start_timestamp=${g}&end_timestamp=${O}&channel=${ue}`);const{success:me,message:pe,data:Ce}=se.data;me?J(Ce):E(pe)},r=async()=>{b(!0),m?await l():await H(),d(!0),b(!1)},n=async g=>{if(!m)return;const O=await v.get(`/api/user/${g}`),{success:se,message:me,data:pe}=O.data;se?fe.info({title:"用户信息",content:e.jsxs("div",{style:{padding:12},children:[e.jsxs("p",{children:["用户名: ",pe.username]}),e.jsxs("p",{children:["余额: ",xe(pe.quota)]}),e.jsxs("p",{children:["已用额度：",xe(pe.used_quota)]}),e.jsxs("p",{children:["请求次数：",pu(pe.request_count)]})]}),centered:!0}):E(me)},M=g=>{for(let O=0;O<g.length;O++)g[O].timestamp2string=we(g[O].created_at),g[O].key=""+g[O].id;a(g),F(g.length+ie)},V=async(g,O,se=0)=>{p(!0);let me="",pe=Date.parse($)/1e3,Ce=Date.parse(y)/1e3;m?me=`/api/log/?p=${g}&page_size=${O}&type=${se}&username=${U}&token_name=${I}&model_name=${Q}&start_timestamp=${pe}&end_timestamp=${Ce}&channel=${ue}`:me=`/api/log/self/?p=${g}&page_size=${O}&type=${se}&token_name=${I}&model_name=${Q}&start_timestamp=${pe}&end_timestamp=${Ce}`;const Ve=await v.get(me),{success:Ye,message:Ze,data:Se}=Ve.data;if(Ye)if(g===0)M(Se);else{let He=[...t];He.splice(g*O,Se.length,...Se),M(He)}else E(Ze);p(!1)},C=t.slice((_-1)*j,_*j),q=g=>{P(g),g===Math.ceil(t.length/j)+1&&V(g-1,j,k).then(O=>{})},A=async g=>{localStorage.setItem("page-size",g+""),o(g),P(1),V(0,g).then().catch(O=>{E(O)})},W=async g=>{P(1),await V(0,j,g)},ne=async g=>{await Re(g)?Z("已复制："+g):fe.error({title:"无法复制到剪贴板，请手动复制",content:g})};return s.useEffect(()=>{const g=parseInt(localStorage.getItem("page-size"))||ie;o(g),V(0,g).then().catch(O=>{E(O)})},[]),e.jsx(e.Fragment,{children:e.jsxs(ae,{children:[e.jsx(_s,{children:e.jsx(Ge,{spinning:B,children:e.jsxs("h3",{children:["使用明细（总消耗额度：",e.jsx("span",{onClick:r,style:{cursor:"pointer",color:"gray"},children:i?xe(R.quota):"点击查看"}),"）"]})})}),e.jsx(X,{layout:"horizontal",style:{marginTop:10},children:e.jsxs(e.Fragment,{children:[e.jsx(X.Input,{field:"token_name",label:"令牌名称",style:{width:176},value:I,placeholder:"可选值",name:"token_name",onChange:g=>z(g,"token_name")}),e.jsx(X.Input,{field:"model_name",label:"模型名称",style:{width:176},value:Q,placeholder:"可选值",name:"model_name",onChange:g=>z(g,"model_name")}),e.jsx(X.DatePicker,{field:"start_timestamp",label:"起始时间",style:{width:272},initValue:$,value:$,type:"dateTime",name:"start_timestamp",onChange:g=>z(g,"start_timestamp")}),e.jsx(X.DatePicker,{field:"end_timestamp",fluid:!0,label:"结束时间",style:{width:272},initValue:y,value:y,type:"dateTime",name:"end_timestamp",onChange:g=>z(g,"end_timestamp")}),m&&e.jsxs(e.Fragment,{children:[e.jsx(X.Input,{field:"channel",label:"渠道 ID",style:{width:176},value:ue,placeholder:"可选值",name:"channel",onChange:g=>z(g,"channel")}),e.jsx(X.Input,{field:"username",label:"用户名称",style:{width:176},value:U,placeholder:"可选值",name:"username",onChange:g=>z(g,"username")})]}),e.jsx(X.Section,{children:e.jsx(w,{label:"查询",type:"primary",htmlType:"submit",className:"btn-margin-right",onClick:W,loading:c,children:"查询"})})]})}),e.jsx(Je,{style:{marginTop:5},columns:u,dataSource:C,pagination:{currentPage:_,pageSize:j,total:x,pageSizeOpts:[10,20,50,100],showSizeChanger:!0,onPageSizeChange:g=>{A(g).then()},onPageChange:q}}),e.jsxs(De,{defaultValue:"0",style:{width:120},onChange:g=>{T(parseInt(g)),W(parseInt(g)).then()},children:[e.jsx(De.Option,{value:"0",children:"全部"}),e.jsx(De.Option,{value:"1",children:"充值"}),e.jsx(De.Option,{value:"2",children:"消费"}),e.jsx(De.Option,{value:"3",children:"管理"}),e.jsx(De.Option,{value:"4",children:"系统"})]})]})})},Ms=()=>e.jsx(e.Fragment,{children:e.jsx(Rs,{})}),Ls=()=>{const u=localStorage.getItem("chat_link");return e.jsx("iframe",{src:u,style:{width:"100%",height:"85vh",border:"none"}})},Uu=["amber","blue","cyan","green","grey","indigo","light-blue","lime","orange","pink","purple","red","teal","violet","yellow"];function zs(u){switch(u){case"IMAGINE":return e.jsx(D,{color:"blue",size:"large",children:"绘图"});case"UPSCALE":return e.jsx(D,{color:"orange",size:"large",children:"放大"});case"VARIATION":return e.jsx(D,{color:"purple",size:"large",children:"变换"});case"HIGH_VARIATION":return e.jsx(D,{color:"purple",size:"large",children:"强变换"});case"LOW_VARIATION":return e.jsx(D,{color:"purple",size:"large",children:"弱变换"});case"PAN":return e.jsx(D,{color:"cyan",size:"large",children:"平移"});case"DESCRIBE":return e.jsx(D,{color:"yellow",size:"large",children:"图生文"});case"BLEND":return e.jsx(D,{color:"lime",size:"large",children:"图混合"});case"SHORTEN":return e.jsx(D,{color:"pink",size:"large",children:"缩词"});case"REROLL":return e.jsx(D,{color:"indigo",size:"large",children:"重绘"});case"INPAINT":return e.jsx(D,{color:"violet",size:"large",children:"局部重绘-提交"});case"ZOOM":return e.jsx(D,{color:"teal",size:"large",children:"变焦"});case"CUSTOM_ZOOM":return e.jsx(D,{color:"teal",size:"large",children:"自定义变焦-提交"});case"MODAL":return e.jsx(D,{color:"green",size:"large",children:"窗口处理"});case"SWAP_FACE":return e.jsx(D,{color:"light-green",size:"large",children:"换脸"});default:return e.jsx(D,{color:"white",size:"large",children:"未知"})}}function Os(u){switch(u){case 1:return e.jsx(D,{color:"green",size:"large",children:"已提交"});case 21:return e.jsx(D,{color:"lime",size:"large",children:"等待中"});case 22:return e.jsx(D,{color:"orange",size:"large",children:"重复提交"});case 0:return e.jsx(D,{color:"yellow",size:"large",children:"未提交"});default:return e.jsx(D,{color:"white",size:"large",children:"未知"})}}function $s(u){switch(u){case"SUCCESS":return e.jsx(D,{color:"green",size:"large",children:"成功"});case"NOT_START":return e.jsx(D,{color:"grey",size:"large",children:"未启动"});case"SUBMITTED":return e.jsx(D,{color:"yellow",size:"large",children:"队列中"});case"IN_PROGRESS":return e.jsx(D,{color:"blue",size:"large",children:"执行中"});case"FAILURE":return e.jsx(D,{color:"red",size:"large",children:"失败"});case"MODAL":return e.jsx(D,{color:"yellow",size:"large",children:"窗口等待"});default:return e.jsx(D,{color:"white",size:"large",children:"未知"})}}const Ns=u=>{const t=new Date(u*1e3),a=t.getFullYear(),i=("0"+(t.getMonth()+1)).slice(-2),d=("0"+t.getDate()).slice(-2),c=("0"+t.getHours()).slice(-2),p=("0"+t.getMinutes()).slice(-2),B=("0"+t.getSeconds()).slice(-2);return`${a}-${i}-${d} ${c}:${p}:${B}`},Gs=()=>{const[u,t]=s.useState(!1),[a,i]=s.useState(""),d=[{title:"提交时间",dataIndex:"submit_time",render:(C,q,A)=>e.jsx("div",{children:Ns(C/1e3)})},{title:"渠道",dataIndex:"channel_id",className:be()?"tableShow":"tableHiddle",render:(C,q,A)=>e.jsx("div",{children:e.jsxs(D,{color:Uu[parseInt(C)%Uu.length],size:"large",onClick:()=>{V(C)},children:[" ",C," "]})})},{title:"类型",dataIndex:"action",render:(C,q,A)=>e.jsx("div",{children:zs(C)})},{title:"任务ID",dataIndex:"mj_id",render:(C,q,A)=>e.jsx("div",{children:C})},{title:"提交结果",dataIndex:"code",className:be()?"tableShow":"tableHiddle",render:(C,q,A)=>e.jsx("div",{children:Os(C)})},{title:"任务状态",dataIndex:"status",className:be()?"tableShow":"tableHiddle",render:(C,q,A)=>e.jsx("div",{children:$s(C)})},{title:"进度",dataIndex:"progress",render:(C,q,A)=>e.jsx("div",{children:e.jsx(jt,{stroke:q.status==="FAILURE"?"var(--semi-color-warning)":null,percent:C?parseInt(C.replace("%","")):0,showInfo:!0,"aria-label":"drawing progress"})})},{title:"结果图片",dataIndex:"image_url",render:(C,q,A)=>C?e.jsx(w,{onClick:()=>{U(C),m(!0)},children:"查看图片"}):"无"},{title:"Prompt",dataIndex:"prompt",render:(C,q,A)=>C?e.jsx(Y.Text,{ellipsis:{showTooltip:!0},style:{width:100},onClick:()=>{i(C),t(!0)},children:C}):"无"},{title:"PromptEn",dataIndex:"prompt_en",render:(C,q,A)=>C?e.jsx(Y.Text,{ellipsis:{showTooltip:!0},style:{width:100},onClick:()=>{i(C),t(!0)},children:C}):"无"},{title:"失败原因",dataIndex:"fail_reason",render:(C,q,A)=>C?e.jsx(Y.Text,{ellipsis:{showTooltip:!0},style:{width:100},onClick:()=>{i(C),t(!0)},children:C}):"无"}],[c,p]=s.useState([]),[B,b]=s.useState(!0),[_,P]=s.useState(1),[x,F]=s.useState(ie),[j,o]=s.useState(0),k=be(),[T,m]=s.useState(!1),[L,G]=s.useState(!1),[K,U]=s.useState("");let I=new Date;const[Q,$]=s.useState({channel_id:"",mj_id:"",start_timestamp:we(I.getTime()/1e3-2592e3),end_timestamp:we(I.getTime()/1e3+3600)}),{channel_id:y,mj_id:ue,start_timestamp:R,end_timestamp:J}=Q;s.useState({quota:0,token:0});const z=(C,q)=>{$(A=>({...A,[q]:C}))},H=C=>{for(let q=0;q<C.length;q++)C[q].timestamp2string=we(C[q].created_at),C[q].key=""+C[q].id;p(C),F(C.length+ie)},l=async C=>{b(!0);let q="",A=Date.parse(R),W=Date.parse(J);k?q=`/api/mj/?p=${C}&channel_id=${y}&mj_id=${ue}&start_timestamp=${A}&end_timestamp=${W}`:q=`/api/mj/self/?p=${C}&mj_id=${ue}&start_timestamp=${A}&end_timestamp=${W}`;const ne=await v.get(q),{success:g,message:O,data:se}=ne.data;if(g)if(C===0)H(se);else{let me=[...c];me.splice(C*ie,se.length,...se),H(me)}else E(O);b(!1)},r=c.slice((_-1)*ie,_*ie),n=C=>{P(C),C===Math.ceil(c.length/ie)+1&&l(C-1).then(q=>{})},M=async()=>{P(1),await l(0)},V=async C=>{await Re(C)?Z("已复制："+C):fe.error({title:"无法复制到剪贴板，请手动复制",content:C})};return s.useEffect(()=>{M().then()},[j]),s.useEffect(()=>{localStorage.getItem("mj_notify_enabled")!=="true"&&G(!0)},[]),e.jsx(e.Fragment,{children:e.jsxs(ae,{children:[k&&L?e.jsx(au,{type:"info",description:"当前未开启Midjourney回调，部分项目可能无法获得绘图结果，可在运营设置中开启。"}):e.jsx(e.Fragment,{}),e.jsx(X,{layout:"horizontal",style:{marginTop:10},children:e.jsxs(e.Fragment,{children:[e.jsx(X.Input,{field:"channel_id",label:"渠道 ID",style:{width:176},value:y,placeholder:"可选值",name:"channel_id",onChange:C=>z(C,"channel_id")}),e.jsx(X.Input,{field:"mj_id",label:"任务 ID",style:{width:176},value:ue,placeholder:"可选值",name:"mj_id",onChange:C=>z(C,"mj_id")}),e.jsx(X.DatePicker,{field:"start_timestamp",label:"起始时间",style:{width:272},initValue:R,value:R,type:"dateTime",name:"start_timestamp",onChange:C=>z(C,"start_timestamp")}),e.jsx(X.DatePicker,{field:"end_timestamp",fluid:!0,label:"结束时间",style:{width:272},initValue:J,value:J,type:"dateTime",name:"end_timestamp",onChange:C=>z(C,"end_timestamp")}),e.jsx(X.Section,{children:e.jsx(w,{label:"查询",type:"primary",htmlType:"submit",className:"btn-margin-right",onClick:M,children:"查询"})})]})}),e.jsx(Je,{style:{marginTop:5},columns:d,dataSource:r,pagination:{currentPage:_,pageSize:ie,total:x,pageSizeOpts:[10,20,50,100],onPageChange:n},loading:B}),e.jsx(fe,{visible:u,onOk:()=>t(!1),onCancel:()=>t(!1),closable:null,bodyStyle:{height:"400px",overflow:"auto"},width:800,children:e.jsx("p",{style:{whiteSpace:"pre-line"},children:a})}),e.jsx(ft,{src:K,visible:T,onVisibleChange:C=>m(C)})]})})},Us=()=>e.jsx(e.Fragment,{children:e.jsx(Gs,{})}),Ws=s.lazy(()=>Tu(()=>import("./index-DOrJX-hs.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),Hs=s.lazy(()=>Tu(()=>import("./index-B0XWZASL.js"),__vite__mapDeps([7,1,8,2,3,4,5,6]))),Ks=s.lazy(()=>Tu(()=>import("./index-Bj_vxtXX.js"),__vite__mapDeps([9,1,4,2,3,5,6])));function qs(){const[u,t]=s.useContext(We),a=()=>{let i=localStorage.getItem("user");if(i){let d=JSON.parse(i);t({type:"login",payload:d})}};return s.useEffect(()=>{a();let i=Eu();i&&(document.title=i);let d=lu();if(d){let c=document.querySelector("link[rel~='icon']");c&&(c.href=d)}},[]),e.jsx(ae,{children:e.jsx(ae.Content,{children:e.jsxs(ct,{children:[e.jsx(Fe,{path:"/",element:e.jsx(s.Suspense,{fallback:e.jsx(ye,{}),children:e.jsx(Ws,{})})}),e.jsx(Fe,{path:"/channel",element:e.jsx(Ie,{children:e.jsx(js,{})})}),e.jsx(Fe,{path:"/channel/edit/:id",element:e.jsx(s.Suspense,{fallback:e.jsx(ye,{}),children:e.jsx(Su,{})})}),e.jsx(Fe,{path:"/channel/add",element:e.jsx(s.Suspense,{fallback:e.jsx(ye,{}),children:e.jsx(Su,{})})}),e.jsx(Fe,{path:"/token",element:e.jsx(Ie,{children:e.jsx(Ds,{})})}),e.jsx(Fe,{path:"/redemption",element:e.jsx(Ie,{children:e.jsx(vs,{})})}),e.jsx(Fe,{path:"/user",element:e.jsx(Ie,{children:e.jsx(us,{})})}),e.jsx(Fe,{path:"/user/edit/:id",element:e.jsx(s.Suspense,{fallback:e.jsx(ye,{}),children:e.jsx(wu,{})})}),e.jsx(Fe,{path:"/user/edit",element:e.jsx(s.Suspense,{fallback:e.jsx(ye,{}),children:e.jsx(wu,{})})}),e.jsx(Fe,{path:"/user/reset",element:e.jsx(s.Suspense,{fallback:e.jsx(ye,{}),children:e.jsx(gs,{})})}),e.jsx(Fe,{path:"/login",element:e.jsx(s.Suspense,{fallback:e.jsx(ye,{}),children:e.jsx(is,{})})}),e.jsx(Fe,{path:"/register",element:e.jsx(s.Suspense,{fallback:e.jsx(ye,{}),children:e.jsx(ts,{})})}),e.jsx(Fe,{path:"/reset",element:e.jsx(s.Suspense,{fallback:e.jsx(ye,{}),children:e.jsx(ms,{})})}),e.jsx(Fe,{path:"/oauth/github",element:e.jsx(s.Suspense,{fallback:e.jsx(ye,{}),children:e.jsx(ps,{})})}),e.jsx(Fe,{path:"/setting",element:e.jsx(Ie,{children:e.jsx(s.Suspense,{fallback:e.jsx(ye,{}),children:e.jsx(Fs,{})})})}),e.jsx(Fe,{path:"/topup",element:e.jsx(Ie,{children:e.jsx(s.Suspense,{fallback:e.jsx(ye,{}),children:e.jsx(ks,{})})})}),e.jsx(Fe,{path:"/log",element:e.jsx(Ie,{children:e.jsx(Ms,{})})}),e.jsx(Fe,{path:"/detail",element:e.jsx(Ie,{children:e.jsx(s.Suspense,{fallback:e.jsx(ye,{}),children:e.jsx(Hs,{})})})}),e.jsx(Fe,{path:"/midjourney",element:e.jsx(Ie,{children:e.jsx(s.Suspense,{fallback:e.jsx(ye,{}),children:e.jsx(Us,{})})})}),e.jsx(Fe,{path:"/about",element:e.jsx(s.Suspense,{fallback:e.jsx(ye,{}),children:e.jsx(Ks,{})})}),e.jsx(Fe,{path:"/chat",element:e.jsx(s.Suspense,{fallback:e.jsx(ye,{}),children:e.jsx(Ls,{})})}),e.jsx(Fe,{path:"*",element:e.jsx(rs,{})})]})})})}localStorage.getItem("chat_link");const Qs=()=>{const[u,t]=s.useContext(We);let a=_e();const[i,d]=s.useState(!1),[c,p]=s.useState(!1);Eu(),lu();var B=localStorage.getItem("theme-mode");const b=new Date,_=b.getMonth()===0&&b.getDate()===1||b.getMonth()===1&&b.getDate()>=9&&b.getDate()<=24;async function P(){d(!1),await v.get("/api/user/logout"),Z("注销成功!"),t({type:"logout"}),localStorage.removeItem("user"),a("/login")}const x=()=>{ju.init("root",{}),ju.start(),setTimeout(()=>{ju.stop(),setTimeout(()=>{window.location.reload()},1e4)},3e3)};s.useEffect(()=>{B==="dark"&&F(!0),_&&console.log("Happy New Year!")},[]);const F=j=>{const o=document.body;j?(o.setAttribute("theme-mode","dark"),localStorage.setItem("theme-mode","dark")):(o.removeAttribute("theme-mode"),localStorage.setItem("theme-mode","light")),p(j)};return e.jsx(e.Fragment,{children:e.jsx(ae,{children:e.jsx("div",{style:{width:"100%"},children:e.jsx($e,{mode:"horizontal",renderWrapper:({itemElement:j,isSubNav:o,isInSubNav:k,props:T})=>{const m={about:"/about",login:"/login",register:"/register"};return e.jsx(eu,{style:{textDecoration:"none"},to:m[T.itemKey],children:j})},selectedKeys:[],onSelect:j=>{},footer:e.jsxs(e.Fragment,{children:[_&&e.jsx(ze,{position:"bottomRight",render:e.jsx(ze.Menu,{children:e.jsx(ze.Item,{onClick:x,children:"Happy New Year!!!"})}),children:e.jsx($e.Item,{itemKey:"new-year",text:"🏮"})}),e.jsx($e.Item,{itemKey:"about",icon:e.jsx(yt,{})}),e.jsx(Du,{checkedText:"🌞",size:"large",checked:c,uncheckedText:"🌙",onChange:F}),u.user?e.jsx(e.Fragment,{children:e.jsxs(ze,{position:"bottomRight",render:e.jsx(ze.Menu,{children:e.jsx(ze.Item,{onClick:P,children:"退出"})}),children:[e.jsx(ku,{size:"small",color:tu(u.user.username),style:{margin:4},children:u.user.username[0]}),e.jsx("span",{children:u.user.username})]})}):e.jsxs(e.Fragment,{children:[e.jsx($e.Item,{itemKey:"login",text:"登录",icon:e.jsx(Qu,{})}),e.jsx($e.Item,{itemKey:"register",text:"注册",icon:e.jsx(Ju,{})})]})]})})})})})};var Js={BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const Vs=()=>{Eu();const[u,t]=s.useState(Qt());let a=5;const i=()=>{let d=localStorage.getItem("footer_html");d&&t(d)};return s.useEffect(()=>{const d=setInterval(()=>{if(a<=0){clearInterval(d);return}a--,i()},200);return()=>clearTimeout(d)},[]),e.jsx(ae,{children:e.jsx(ae.Content,{style:{textAlign:"center"},children:u?e.jsx("div",{className:"custom-footer",dangerouslySetInnerHTML:{__html:u}}):e.jsxs("div",{className:"custom-footer",children:[e.jsxs("a",{href:"https://github.com/Calcium-Ion/new-api",target:"_blank",rel:"noreferrer",children:["New API ",Js.VITE_REACT_APP_VERSION," "]}),"由"," ",e.jsx("a",{href:"https://github.com/Calcium-Ion",target:"_blank",rel:"noreferrer",children:"Calcium-Ion"})," ","开发，基于"," ",e.jsx("a",{href:"https://github.com/songquanpeng/one-api",target:"_blank",rel:"noreferrer",children:"One API v0.5.4"})," ","，本项目根据"," ",e.jsx("a",{href:"https://opensource.org/licenses/mit-license.php",children:"MIT 许可证"})," ","授权"]})})})},Ys=(u,t)=>{switch(t.type){case"set":return{...u,status:t.payload};case"unset":return{...u,status:void 0};default:return u}},nt={status:void 0},at=su.createContext({state:nt,dispatch:()=>null}),Zs=({children:u})=>{const[t,a]=su.useReducer(Ys,nt);return e.jsx(at.Provider,{value:[t,a],children:u})},Xs=()=>{s.useContext(We);const[u,t]=s.useContext(at),a=Be()||localStorage.getItem("default_collapse_sidebar")==="true";_e();const[i,d]=s.useState(["home"]),c=Eu(),p=lu(),[B,b]=s.useState(a),_={home:"/",channel:"/channel",token:"/token",redemption:"/redemption",topup:"/topup",user:"/user",log:"/log",midjourney:"/midjourney",setting:"/setting",about:"/about",chat:"/chat",detail:"/detail"},P=s.useMemo(()=>[{text:"首页",itemKey:"home",to:"/",icon:e.jsx(Bt,{})},{text:"渠道",itemKey:"channel",to:"/channel",icon:e.jsx(Dt,{}),className:be()?"semi-navigation-item-normal":"tableHiddle"},{text:"聊天",itemKey:"chat",to:"/chat",icon:e.jsx(At,{}),className:localStorage.getItem("chat_link")?"semi-navigation-item-normal":"tableHiddle"},{text:"令牌",itemKey:"token",to:"/token",icon:e.jsx(Qu,{})},{text:"兑换码",itemKey:"redemption",to:"/redemption",icon:e.jsx(bt,{}),className:be()?"semi-navigation-item-normal":"tableHiddle"},{text:"钱包",itemKey:"topup",to:"/topup",icon:e.jsx(wt,{})},{text:"用户管理",itemKey:"user",to:"/user",icon:e.jsx(Ju,{}),className:be()?"semi-navigation-item-normal":"tableHiddle"},{text:"日志",itemKey:"log",to:"/log",icon:e.jsx(St,{})},{text:"数据看板",itemKey:"detail",to:"/detail",icon:e.jsx(vt,{}),className:localStorage.getItem("enable_data_export")==="true"?"semi-navigation-item-normal":"tableHiddle"},{text:"绘图",itemKey:"midjourney",to:"/midjourney",icon:e.jsx(kt,{}),className:localStorage.getItem("enable_drawing")==="true"?"semi-navigation-item-normal":"tableHiddle"},{text:"设置",itemKey:"setting",to:"/setting",icon:e.jsx(_t,{})}],[localStorage.getItem("enable_data_export"),localStorage.getItem("enable_drawing"),localStorage.getItem("chat_link"),be()]),x=async()=>{const F=await v.get("/api/status");if(F===void 0)return;const{success:j,data:o}=F.data;j?(localStorage.setItem("status",JSON.stringify(o)),t({type:"set",payload:o}),localStorage.setItem("system_name",o.system_name),localStorage.setItem("logo",o.logo),localStorage.setItem("footer_html",o.footer_html),localStorage.setItem("quota_per_unit",o.quota_per_unit),localStorage.setItem("display_in_currency",o.display_in_currency),localStorage.setItem("enable_drawing",o.enable_drawing),localStorage.setItem("enable_data_export",o.enable_data_export),localStorage.setItem("data_export_default_time",o.data_export_default_time),localStorage.setItem("default_collapse_sidebar",o.default_collapse_sidebar),localStorage.setItem("mj_notify_enabled",o.mj_notify_enabled),o.chat_link?localStorage.setItem("chat_link",o.chat_link):localStorage.removeItem("chat_link"),o.chat_link2?localStorage.setItem("chat_link2",o.chat_link2):localStorage.removeItem("chat_link2")):E("无法正常连接至服务器！")};return s.useEffect(()=>{x().then(()=>{b(Be()||localStorage.getItem("default_collapse_sidebar")==="true")});let F=window.location.pathname.split("/")[1];F===""&&(F="home"),d([F])},[]),e.jsx(e.Fragment,{children:e.jsx(ae,{children:e.jsx("div",{style:{height:"100%"},children:e.jsx($e,{style:{maxWidth:200},defaultIsCollapsed:Be()||localStorage.getItem("default_collapse_sidebar")==="true",isCollapsed:B,onCollapseChange:F=>{b(F)},selectedKeys:i,renderWrapper:({itemElement:F,isSubNav:j,isInSubNav:o,props:k})=>e.jsx(eu,{style:{textDecoration:"none"},to:_[k.itemKey],children:F}),items:P,onSelect:F=>{d([F.itemKey])},header:{logo:e.jsx("img",{src:p,alt:"logo",style:{marginRight:"0.75em"}}),text:c},children:e.jsx($e.Footer,{collapseButton:!0})})})})})},en=bu.createRoot(document.getElementById("root")),{Sider:un,Content:tn,Header:sn}=ae;en.render(e.jsx(su.StrictMode,{children:e.jsx(Zs,{children:e.jsx(ns,{children:e.jsx(dt,{children:e.jsxs(ae,{children:[e.jsx(un,{children:e.jsx(Xs,{})}),e.jsxs(ae,{children:[e.jsx(sn,{children:e.jsx(Qs,{})}),e.jsx(tn,{style:{padding:"24px"},children:e.jsx(qs,{})}),e.jsx(ae.Footer,{children:e.jsx(Vs,{})})]}),e.jsx(Rt,{})]})})})})}));export{v as A,at as S,E as a,pu as b,cn as c,xe as d,hn as g,be as i,e as j,Fn as m,dn as r,Lu as s,we as t};
